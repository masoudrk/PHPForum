/*
 sepanta 2018-12-08 
*/
var appName="forumApp",serviceBaseURL="../api/user/",uploadURL="../api/upload/",debugMode=!1,app=angular.module(appName,["ngRoute","treasure-overlay-spinner","ui.router","angular-confirm","oc.lazyLoad","ngAnimate","toaster","ui.bootstrap","ui.router.title","ui.select","ngPersian","ngFileUpload","anim-in-out","am-charts","ng-fx","ngImgCrop","ADM-dateTimePicker","ngSanitize","textAngular","ngCookies"]);app.config(["$provide","$stateProvider","$urlRouterProvider","$ocLazyLoadProvider",function(a,b,c,d){d.config({debug:debugMode,events:!0}),b.state("dashboard",{url:"/Dashboard",templateUrl:"angular.partial.Dashboard.html",controller:"DashboardCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"داشبورد"}}}).state("upload_library",{url:"/UploadLibrary",templateUrl:"angular.partial.UploadLibrary.html",controller:"UploadLibraryCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"آپلود فایل"}}}).state("main_forum",{url:"/MainForum/:id",templateUrl:"angular.partial.MainForum.html",controller:"MainForumCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"انجمن"}}}).state("forum",{url:"/Forum/:id",templateUrl:"angular.partial.Forum.html",controller:"ForumCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"انجمن"}}}).state("new_question",{url:"/NewQuestion/:id",templateUrl:"angular.partial.NewQuestion.html",controller:"NewQuestionCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"سوال جدید"}}}).state("questions",{url:"/MyQuestions",templateUrl:"angular.partial.Questions.html",controller:"QuestionsCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"سوالات شما"}}}).state("my_answers",{url:"/MyAnswers",templateUrl:"angular.partial.Answers.html",controller:"AnswersCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"جواب های شما"}}}).state("my_following",{url:"/Follow/:action",templateUrl:"angular.partial.Follow.html",controller:"FollowCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"دنبال شده ها"}}}).state("question",{url:"/Question/:id",templateUrl:"angular.partial.Question.html",controller:"QuestionCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"سوال"}}}).state("UserProfile",{url:"/UserProfile/:id",templateUrl:"angular.partial.UserProfile.html",controller:"UserProfileCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"پروفایل"}}}).state("messages",{url:"/Messages/:id",templateUrl:"angular.partial.Message.html",controller:"MessageCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت پیام ها"}}}).state("profile",{url:"/Profile/:action",templateUrl:"angular.partial.Profile.html",controller:"ProfileCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"پروفایل من"}}}).state("rating",{url:"/Rating/:id",templateUrl:"angular.partial.Rating.html",controller:"RatingCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"نظرسنجی"}}}).state("library",{url:"/Library",templateUrl:"angular.partial.Library.html",controller:"LibraryCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../js/angular-clipboard.js"])}],$title:function(){return"کتابخانه"}}}).state("quiz",{url:"/Quiz/:id",templateUrl:"angular.partial.Quiz.html",controller:"QuizCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"آزمون"}}}).state("about",{url:"/About",templateUrl:"angular.partial.About.html",controller:"AboutCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"درباره ما"}}}).state("file",{url:"/File/:id",templateUrl:"angular.partial.File.html",controller:"FileCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../js/angular-clipboard.js"])}],$title:function(){return"مشخصات فایل"}}}).state("help",{url:"/Help",templateUrl:"angular.partial.Help.html",controller:"HelpCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"راهنمای سایت"}}}).state("admin_post",{url:"/AdminPost/:id",templateUrl:"angular.partial.AdminPost.html",controller:"AdminPostCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مطلب ادمین"}}}).state("survey",{url:"/Survey/:id",templateUrl:"angular.partial.Survey.html",controller:"SurveyCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"نظرسنجی"}}}),c.otherwise(function(a,b){var c=a.get("$state");c.go("main_forum",{id:"Transition"})}),a.decorator("taOptions",["taRegisterTool","$uibModal","$delegate",function(a,b,c){return c.toolbar=[["h1","h4","h6","p","pre","quote"],["html","customInsertImage","insertLink","wordcount","charcount"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["dirLtr","dirRtl"]],a("dirLtr",{iconclass:"fa fa-indent",action:function(){return this.$editor().wrapSelection("formatBlock",'<P style="direction:ltr">')}}),a("dirRtl",{iconclass:"fa fa-dedent",action:function(){return this.$editor().wrapSelection("formatBlock",'<P style="direction:rtl">')}}),a("customInsertImage",{iconclass:"fa fa-picture-o",action:function(a){var c=this,d=rangy.saveSelection(),e=b.open({templateUrl:"../js/text-angular/CustomSelectImageModal.tmpl.html",size:"md",controller:["$uibModalInstance","$scope","Upload","$state",function(a,b,c,d){b.activeTab=0,b.img={url:""},b.submit=function(){a.close(b.img.url)},b.cancel=function(){a.close()},b.getTab=function(a){b.activeTab=a},b.addImageLink=function(b){a.close(b)},b.filesChanged=function(b,e){var f=uploadURL;f+="upload_inline_attachment.php";var g={file:e};g.Type=d.current.name,e.uploader=c.upload({url:f,data:g}),e.uploader.then(function(b){a.close(b.data),console.log("Success "+b.config.data.file.name+"uploaded. Response: "+b.data)},function(a){console.log("Error status: "+a.status)},function(a){var b=parseInt(100*a.loaded/a.total);a.config.data.file.percent=b})},b.stopUploadImage=function(a){a.uploader.abort()}}]});return e.result.then(function(b){if(b){rangy.restoreSelection(d);var e='<a href="'+b+'" target="_blank"><img class="img-responsive link attachment-inline-img"  src="'+b+'"  /></a>';c.$editor().wrapSelection("insertHtml",e),a.resolve()}}),!1}}),c}])}]);var activeElement=function(a,b){if(b){var c=$(b);c.addClass("active").siblings().removeClass("active")}var d=$(a);d.addClass("active").siblings().removeClass("active")};app.run(["$rootScope","$templateCache","$state","$location","Extention","OnlineSocket",function(a,b,c,d,e,f){a.breadcrumbs=[],a.breadcrumbs.push({title:"خانه",url:"home.php"}),a.spinner={},a.$on("$stateChangeSuccess",function(a,b,c,d,f){e.setBusy(!1)}),a.$on("$stateChangeError",function(a,b,c,d,f,g){e.setBusy(!1)}),a.$on("$stateNotFound",function(a,b,c,d){e.setBusy(!1)}),a.$on("$stateChangeStart",function(b,c,d){e.setBusy(!0),a.globalSearchActive&&(a.globalSearchActive=!1)})}]),app.factory("Extention",["$http","$timeout","$rootScope","$state","$stateParams","toaster","$uibModal",function(a,b,c,d,e,f,g){c.logout=function(){i.post("logout").then(function(a){a&&"success"===a.Status?window.location="../":i.popError("مشکل ، لطفا دوباره امتحان کنید.")})},c.user=session;var h=serviceBaseURL;c.spinner={};var i={};return i.workers=0,i.serviceBase=h,i.debugMode=debugMode,i.noImageClass="fa fa-2x fa-user",i.addRoute=function(a,b){c.breadcrumbs.push({title:a,url:b}),c.breadcrumbs.length>2&&c.breadcrumbs.splice(0,1)},i.subString=function(a,b){return a&&a.length>b?a.substr(0,b)+"...":a},i.setBusy=function(a){a?(0===i.workers&&(c.spinner.active=!0),i.workers++):(i.workers--,0===i.workers&&b(i.disableLoading,250))},i.pop=function(a,b,c){c||(c=7e3),f.pop(a,"",b,c,"trustedHtml")},i.popError=function(a,b){b||(b=7e3),f.pop("error","",a,b,"trustedHtml")},i.popSuccess=function(a,b){b||(b=7e3),f.pop("success","",a,b,"trustedHtml")},i.popInfo=function(a,b){b||(b=7e3),f.pop("info","",a,b,"trustedHtml")},i.popWarning=function(a,b){b||(b=7e3),f.pop("warning","",a,b,"trustedHtml")},i.popModal=function(a){g.open({animation:!0,templateUrl:"notifyModal.html",controller:["$scope","$uibModalInstance","data",function(a,b,c){a.data=c}],size:"md",resolve:{data:function(){return a}}})},i.get=function(b){return i.setBusy(!0),a.get(h+b).then(function(a){return i.setBusy(!1),a.data},function(a){return i.setBusy(!1),a})},i.getExternal=function(b){return i.setBusy(!0),a.get(b).then(function(a){return i.setBusy(!1),a.data},function(a){return i.setBusy(!1),a})},i.post=function(b,c){return i.setBusy(!0),a.post(h+b,c).then(function(a){return i.debugMode&&(console.log(a.data),200!=a.status&&i.popModal(a)),i.setBusy(!1),a.data.AuthState&&"UN_AUTH"==a.data.AuthState&&(console.log("State : UN_AUTHORIZED_USER"),window.location="../"),a.data},function(a){return i.debugMode&&(console.log(a.data),i.popModal(a.data)),a.data.AuthState&&"UN_AUTH"==a.data.AuthState&&(console.log("State : UN_AUTHORIZED_USER"),window.location="../"),i.setBusy(!1),a})},i.postAsync=function(b,c){return a.post(h+b,c).then(function(a){return i.debugMode&&200!=a.status&&i.popModal(a),a.data},function(a){return i.debugMode&&i.popModal(a.data),a})},i.disableLoading=function(){c.spinner.active=!1},i.authUser=function(a){return a.Valid?void(c.user=a.Session):void i.unAuthUser()},i.unAuthUser=function(){c.user=void 0},i.isAdmin=function(){return c.isAdmin},i.getAuth=function(){return{authenticated:c.authenticated,isAdmin:c.isAdmin}},i.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}var c=b(),d=a,e=d>c?d-c:c-d;if(e<100)return void scrollTo(0,d);var f=Math.round(e/10);f>=5&&(f=5);var g=Math.round(e/25),h=d>c?c+g:c-g,i=0;if(d>c)for(var j=c;j<d;j+=g)setTimeout("window.scrollTo(0, "+h+")",i*f),h+=g,h>d&&(h=d),i++;else for(var j=c;j>d;j-=g)setTimeout("window.scrollTo(0, "+h+")",i*f),h-=g,h<d&&(h=d),i++},i.scrollToElement=function(a,b){function c(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function d(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!=document.body;)d=d.offsetParent,c+=d.offsetTop;return c}b||(b=0);var e=c(),f=d(a)+b,g=f>e?f-e:e-f;if(g<100)return void scrollTo(0,f);var h=Math.round(g/10);h>=5&&(h=5);var i=Math.round(g/25),j=f>e?e+i:e-i,k=0;if(f>e)for(var l=e;l<f;l+=i)setTimeout("window.scrollTo(0, "+j+")",k*h),j+=i,j>f&&(j=f),k++;else for(var l=e;l>f;l-=i)setTimeout("window.scrollTo(0, "+j+")",k*h),j-=i,j<f&&(j=f),k++},i}]),app.factory("OnlineSocket",["$http","$timeout","$rootScope","Extention",function(a,b,c,d){var e={};return e.getData=function(){b(function(){e.fetch()},5e4)},e.fetch=function(){d.postAsync("getSocketData").then(function(a){c.socketData=a,b(function(){c.$broadcast("socketDataChanged")}),e.getData()})},e.fetch(),e}]),app.filter("fileSizeFilter",function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["بایت","کیلوبایت","مگابایت","گیگابایت","ترابایت","پتابایت"],d=Math.floor(Math.log(a)/Math.log(1024));return persianJs((a/Math.pow(1024,Math.floor(d))).toFixed(b)).englishNumber().toString()+" "+c[d]}}),app.filter("fileSizeFilterEnglish",function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["B","KB","MB","GB","TB","PT"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}),app.filter("propsFilter",function(){return function(a,b){var c=[];if(angular.isArray(a)){var d=Object.keys(b);a.forEach(function(a){for(var e=!1,f=0;f<d.length;f++){var g=d[f],h=b[g].toLowerCase();if(a[g].toString().toLowerCase().indexOf(h)!==-1){e=!0;break}}e&&c.push(a)})}else c=a;return c}}),app.filter("jalaliDate",function(){return function(a,b){var c=moment(a);return c.fromNow()+" "+c.format(b)}}),app.filter("fromNow",function(){return function(a){var b=moment(a);return b.fromNow()}}),app.filter("jalaliDateSimple",function(){return function(a,b){var c=moment(a);return c.format(b)}}),app.filter("moment",function(){return function(a,b){return moment(a).format(b)}}),app.filter("concat",function(){return function(a,b){return a+b}}),app.filter("subString",function(){return function(a,b){return a&&a.length>b?a.substr(0,b)+"...":a}}),app.filter("split",function(){return function(a,b,c){if(!a)return"";for(var d="",e=0;e<a.length;e++)d+=e===a.length-1?a[e][c]:a[e][c]+b;return d}}),app.filter("capitalize",function(){return function(a,b){var c=b?/([^\W_]+[^\s-]*) */g:/([^\W_]+[^\s-]*)/;return a?a.replace(c,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}),app.directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}),app.directive("slideable",function(){return{restrict:"C",compile:function(a,b){var c=a.html();return a.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+c+"</div>"),function(a,b,c){c.duration=c.duration?c.duration:"1s",c.easing=c.easing?c.easing:"ease-in-out",b.css({overflow:"hidden",height:"0px",transitionProperty:"height",transitionDuration:c.duration,transitionTimingFunction:c.easing})}}}}),app.directive("slideToggle",function(){return{restrict:"A",link:function(a,b,c){var d=document.querySelector(c.slideToggle);c.expanded=!1,b.bind("click",function(){var a=d.querySelector(".slideable_content");if(c.expanded)d.style.height="0px";else{a.style.border="1px solid rgba(0,0,0,0)";var b=a.clientHeight;a.style.border=0,d.style.height=b+"px"}c.expanded=!c.expanded})}}}),app.directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]),angular.module("ui.router.title",["ui.router"]).run(["$rootScope","$timeout","$state","Extention",function(a,b,c,d){function e(a){return angular.isFunction(a)?a():a}a.$on("$stateChangeSuccess",function(){var f=c.$current.locals.globals.$title,g=c.$current.locals.globals.$isAsyncTitle;if(g)d.post(f).then(function(d){b(function(){a.$title=d.SiteName}),a.$breadcrumbs=[];for(var f=c.$current;f;)f.resolve&&f.resolve.$title&&a.$breadcrumbs.unshift({title:e(f.locals.globals.$title),state:f.self.name,stateParams:f.locals.globals.$stateParams}),f=f.parent});else{var h=e(f);b(function(){a.$title=h}),a.$breadcrumbs=[];for(var i=c.$current;i;)i.resolve&&i.resolve.$title&&a.$breadcrumbs.unshift({title:e(i.locals.globals.$title),state:i.self.name,stateParams:i.locals.globals.$stateParams}),i=i.parent}})}]),app.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module(appName).controller("AboutCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention",function(a,b,c,d,e,f){a.bgColorArray=["bg-aqua-active","bg-orange","bg-purple-active","bg-navy-active","bg-orange-active","bg-blue-active","bg-green-active","bg-light-blue","bg-lime-active","bg-fuchsia-active","bg-yellow-active","bg-red-active","bg-maroon-active","bg-light-blue-active","bg-black-active","bg-green","bg-navy","bg-teal","bg-olive","bg-lime","bg-fuchsia","bg-purple","bg-maroon","bg-teal-active","bg-red","bg-yellow","bg-aqua","bg-blue","bg-olive-active"],a.getRandomColorClass=function(b){var c=b%a.bgColorArray.length;return a.bgColorArray[c]},f.post("getAllAdminsForAbout").then(function(b){a.data=b}),activeElement("#SOthers","#SAbout")}]),angular.module(appName).controller("DashboardCtrl",["$scope","$element","$rootScope","$routeParams","$state","$location","$timeout","$log",function(a,b,c,d,e,f,g,h){fixFooter()}]),angular.module(appName).controller("QuizCtrl",["$scope","$rootScope","$stateParams","$state","$location","$timeout","$uibModal","Extention","Upload",function(a,b,c,d,e,f,g,h,i){c.id&&h.post("getUserMessageByID",{MessageID:c.id}).then(function(b){a.showMessage(b)}),a.showMessage=function(b){0==b.MessageViewed&&h.postAsync("markAsReadMessage",{MessageID:b.ID}).then(function(b){for(var c=0;c<a.message.all.length;c++)if(a.message.all[c].ID==b.Data){a.message.all[c].MessageViewed=1;break}for(var d=a.$parent.messages.All,c=0;c<d.length;c++)if(d[c].ID==b.Data){d.splice(c,1);var d=a.$parent.messages.Total-=1;break}}),g.open({animation:!0,templateUrl:"messageModal.html",controller:["$scope","$uibModalInstance","Message",function(a,c,e){a.message=e,a.getAdmin=function(){d.go("UserProfile",{id:b.SenderUserID}),c.dismiss("cancel")},a.cancel=function(){c.dismiss("cancel")}}],size:"md",resolve:{Message:function(){return b}}})},activeElement("#SQuiz")}]),angular.module(appName).controller("RatingCtrl",["$scope","$rootScope","$stateParams","$state","$location","$timeout","$uibModal","Extention","Upload",function(a,b,c,d,e,f,g,h,i){c.id&&h.post("getUserMessageByID",{MessageID:c.id}).then(function(b){a.showMessage(b)}),a.showMessage=function(b){0==b.MessageViewed&&h.postAsync("markAsReadMessage",{MessageID:b.ID}).then(function(b){for(var c=0;c<a.message.all.length;c++)if(a.message.all[c].ID==b.Data){a.message.all[c].MessageViewed=1;break}for(var d=a.$parent.messages.All,c=0;c<d.length;c++)if(d[c].ID==b.Data){d.splice(c,1);var d=a.$parent.messages.Total-=1;break}}),g.open({animation:!0,templateUrl:"messageModal.html",controller:["$scope","$uibModalInstance","Message",function(a,c,e){a.message=e,a.getAdmin=function(){d.go("UserProfile",{id:b.SenderUserID}),c.dismiss("cancel")},a.cancel=function(){c.dismiss("cancel")}}],size:"md",resolve:{Message:function(){return b}}})},activeElement("#SRating")}]),angular.module(appName).controller("FileCtrl",["$scope","$rootScope","$stateParams","$state","$location","$timeout","Extention","Upload","clipboard",function(a,b,c,d,e,f,g,h,i){a.file={},(a.getFileByID=function(){g.post("getFileByID",{FileID:c.id}).then(function(b){"success"==b.Status?(console.log(b.Data),a.file=b.Data):a.file=null})})(),a.downloadFile=function(a){var b=e.absUrl(),c=b.indexOf("#"),d=b.substr(0,c);window.open(d+a.FullPath,"_blank")},a.copyFileLink=function(a){var b=e.absUrl(),c=b.indexOf("#"),d=b.substr(0,c);i.copyText(d+"../"+a.AbsolutePath),g.popInfo("لینک فایل کپی شد.")}}]),angular.module(appName).controller("HomeCtrl",["$scope","$element","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g,h){a.changeView=function(a){hideCMS(!1),e.go("main_forum",{id:a})},activeElement("#SForum","#SForumHome")}]),angular.module(appName).controller("AdminPostCtrl",["$scope","$element","$rootScope","$uibModal","$routeParams","$state","$location","$timeout","$stateParams","Extention",function(a,b,c,d,e,f,g,h,i,j){a.isOnline=!1,a.adminPost={},(a.getAdminPostID=function(){j.post("getAdminPostID",{AdminPostID:i.id}).then(function(b){"success"==b.Status?(a.adminPost=b.Data,a.checkNowOnline(),c.breadcrumbs=[],c.breadcrumbs.push({title:"خانه",url:"home.php",icon:"fa-home"}),c.breadcrumbs.push({title:b.Data.MainSubject,url:f.href("main_forum",{id:b.Data.SubjectName})}),c.breadcrumbs.push({title:b.Data.Subject,url:f.href("forum",{id:b.Data.SubjectID})}),c.breadcrumbs.push({title:j.subString(b.Data.Title,22)})):a.adminPost=null})})(),a.getInlineImageView=function(a){d.open({animation:!0,templateUrl:"inlineImageView.html",controller:["$scope","$uibModalInstance","link",function(a,b,c){a.link=c,a.downloadAttachment=function(){var a=g.absUrl(),b=a.indexOf("#");a.substr(0,b);window.open(c,"_blank")},a.cancel=function(){b.dismiss("cancel")}}],size:"lg",resolve:{link:function(){return a}}})},a.openAttachments=function(a){d.open({animation:!0,templateUrl:"myModalContent.html",controller:["$scope","$uibModalInstance","Attachment",function(a,b,c){a.attachment=c,a.downloadAttachment=function(){var b=g.absUrl(),c=b.indexOf("#"),d=b.substr(0,c);window.open(d+a.attachment.FullPath,"_blank")},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}],size:"md",resolve:{Attachment:function(){return a}}})},c.$on("socketDataChanged",function(){a.checkNowOnline()}),a.checkNowOnline=function(){if(a.adminPost||a.adminPost.UserID){for(var b=a.socketData.OnlineUsers,c=0;c<b.length;c++)if(a.adminPost.UserID==b[c].ID)return void(a.isOnline=!0);a.isOnline=!1}},a.getBoxColor=function(a){switch(a=a%5+1){case 1:return"box-success";case 2:return"box-warning";case 3:return"box-info";case 4:return"box-primary";case 5:return"box-danger";default:return"box-success"}},a.getTagColor=function(a){switch(a=a%5+1){case 1:return"label-success";case 2:return"label-warning";case 4:return"label-primary";case 5:return"label-danger";default:return"label-success"}},a.getBGColor=function(a){switch(a=a%15+1){case 1:return"bg-red-active";case 2:return"bg-yellow-active";case 3:return"bg-aqua-active";case 4:return"bg-blue-active";case 5:return"bg-light-blue-active";case 6:return"bg-green-active";case 7:return"bg-navy-active";case 8:return"bg-teal-active";case 9:return"bg-olive-active";case 10:return"bg-lime-active";case 11:return"bg-orange-active";case 12:return"bg-fuchsia-active";case 13:return"bg-purple-active";case 14:return"bg-maroon-active";case 15:return"bg-black-active";default:return"bg-red-active"}}}]),angular.module(appName).controller("ForumCtrl",["$scope","$element","$rootScope","$stateParams","$state","$timeout","Extention",function(a,b,c,d,e,f,g){d.id&&""!=d.id||e.go("forum_home"),a.pagingParams={SubjectID:d.id},a.question={},g.post("getSubForumData",{SubjectID:d.id}).then(function(b){a.forumData=b,c.breadcrumbs=[],c.breadcrumbs.push({title:"خانه",url:"home.php",icon:"fa-home"}),c.breadcrumbs.push({title:b.Subject.MainTitle,url:e.href("main_forum",{id:b.Subject.MainSubjectName})}),c.breadcrumbs.push({title:b.Subject.Title})}),a.pagingControllerLastQuestions={},a.pagingControllerBestQuestions={},a.pagingControllerAnswered={},a.pagingControllerFollowingQuestions={},a.pcAdminPost={},a.pcAdminPosts={},a.getTab=function(b){switch(b){case 0:a.pagingControllerLastQuestions.update();break;case 1:a.pagingControllerBestQuestions.update();break;case 2:a.pagingControllerAnswered.update();break;case 3:a.pagingControllerFollowingQuestions.update();break;case 4:a.pcAdminPost.update()}a.activeTab=b},a.getDownTab=function(b){switch(b){case 0:a.pcAdminPosts.update()}a.activeDownTab=b},f(function(){a.getTab(0),a.getDownTab(0)}),a.incrementChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"IQuestionCount",fillColors:"#00BBCC",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"IAnswerCount",fillColors:"#e74c3c",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],a.dailyChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"QuestionCount",fillColors:"#00BBCC",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"AnswerCount",fillColors:"#e74c3c",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],activeElement("#SForum","#S"+d.id)}]),angular.module(appName).controller("MainForumCtrl",["$scope","$element","$rootScope","$stateParams","$state","$timeout","Extention",function(a,b,c,d,e,f,g){d.id&&""!=d.id||e.go("forum_home"),a.pagingControllerLastQuestions={},a.pagingControllerBestQuestions={},a.pagingControllerAnswered={},a.pagingControllerFollowingQuestions={},a.pcAdminPost={},a.pcAdminPosts={},a.getTab=function(b){switch(b){case 0:a.pagingControllerLastQuestions.update();break;case 1:a.pagingControllerBestQuestions.update();break;case 2:a.pagingControllerAnswered.update();break;case 3:a.pagingControllerFollowingQuestions.update();break;case 4:a.pcAdminPost.update()}a.activeTab=b},a.getDownTab=function(b){switch(b){case 0:a.pcAdminPosts.update()}a.activeDownTab=b},f(function(){a.getTab(0),a.getDownTab(0)}),a.bgColorArray=["bg-aqua-active","bg-orange","bg-purple-active","bg-navy-active","bg-orange-active","bg-blue-active","bg-green-active","bg-light-blue","bg-lime-active","bg-fuchsia-active","bg-yellow-active","bg-red-active","bg-maroon-active","bg-light-blue-active","bg-black-active","bg-green","bg-navy","bg-teal","bg-olive","bg-lime","bg-fuchsia","bg-purple","bg-maroon","bg-teal-active","bg-red","bg-yellow","bg-aqua","bg-blue","bg-olive-active"],a.getRandomColorClass=function(b){var c=b%a.bgColorArray.length;return a.bgColorArray[c]},a.pieChartOptions={type:"pie",valueField:"Value",fontSize:12,marginLeft:0,marginRight:0,marginBottom:-80,marginTop:-80,theme:"light",autoMargins:!0,dataProvider:a.chartData,colors:["#00BBCC","#e74c3c"],labelFunction:function(a){var b=a.dataContext.Name;return persianJs(b+"").englishNumber().toString()},balloonFunction:function(a){var b=a.dataContext.Value;return'<b style="font-size: 13px">'+persianJs(b+"").englishNumber().toString()+"<br/>"+a.dataContext.Name+"</b>"}},a.incrementChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"IQuestionCount",fillColors:"#00BBCC",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"IAnswerCount",fillColors:"#e74c3c",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],a.dailyChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"QuestionCount",fillColors:"#00BBCC",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"AnswerCount",fillColors:"#e74c3c",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],a.pagingParams={MainSubjectName:d.id},a.question={},a.adminPost={},g.post("getMainForumData",{MainSubjectName:d.id}).then(function(b){a.forumData=b,c.breadcrumbs=[],c.breadcrumbs.push({title:"خانه",url:"home.php",icon:"fa-home"}),c.breadcrumbs.push({title:b.MainSubject.Title})}),a.followSubject=function(b){g.postAsync("followSubject",{SubjectID:b}).then(function(c){if(console.log(c),"success"==c.Status)for(var d=0;d<a.forumData.SubjectChilds.length;d++)if(a.forumData.SubjectChilds[d].ID==b)return a.forumData.SubjectChilds[d].PersonFollow=1,void(a.forumData.SubjectChilds[d].FollowCount=Number(a.forumData.SubjectChilds[d].FollowCount)+1)})},a.unFollowSubject=function(b){g.postAsync("unFollowSubject",{SubjectID:b}).then(function(c){if("success"==c.Status)for(var d=0;d<a.forumData.SubjectChilds.length;d++)if(a.forumData.SubjectChilds[d].ID==b)return a.forumData.SubjectChilds[d].PersonFollow=0,void(a.forumData.SubjectChilds[d].FollowCount=Number(a.forumData.SubjectChilds[d].FollowCount)-1)})},a.followMainSubject=function(b){g.postAsync("followMainSubject",{MainSubjectID:b}).then(function(b){console.log(b),"success"==b.Status&&(a.forumData.MainSubject.PersonFollow=1)})},a.unFollowMainSubject=function(b){g.postAsync("unFollowMainSubject",{MainSubjectID:b}).then(function(b){"success"==b.Status&&(a.forumData.MainSubject.PersonFollow=0)})},activeElement("#SForum","#S"+d.id)}]),angular.module(appName).controller("QuestionCtrl",["$scope","$element","$rootScope","$uibModal","$routeParams","$state","$location","$timeout","$stateParams","Extention","Upload",function(a,b,c,d,e,f,g,h,i,j,k){a.isOnline=!1,a.question={},(a.getQuestionByID=function(){j.post("getQuestionByID",{QuestionID:i.id,UserID:c.user.UserID}).then(function(b){if("success"==b.Status){a.question=b.Data;for(var d=null,e=0;e<a.question.Answers.length;e++)if(0!=a.question.Answers[e].BestAnswer){d=e;break}if(d){var g=a.question.Answers[d];a.question.Answers[d]=a.question.Answers[0],a.question.Answers[0]=g}a.checkNowOnline(),c.breadcrumbs=[],c.breadcrumbs.push({title:"خانه",url:"home.php",icon:"fa-home"}),c.breadcrumbs.push({title:b.Data.MainSubject,url:f.href("main_forum",{id:b.Data.SubjectName})}),c.breadcrumbs.push({title:b.Data.Subject,url:f.href("forum",{id:b.Data.SubjectID})}),c.breadcrumbs.push({title:j.subString(b.Data.Title,22)})}else a.question=null,console.log(b)})})(),a.addToAvardedQuestions=function(b){j.post("setAwardedQuestion",{QuestionID:b}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.rmAvardedQuestions=function(b){j.post("deleteAwardedQuestion",{QuestionID:b}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.deleteBestAnswer=function(b){j.post("deleteBestAnswer",{QuestionID:i.id,AnswerID:b}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.setBestAnswer=function(b){j.post("setBestAnswer",{QuestionID:i.id,AnswerID:b}).then(function(b){"success"==b.Status?a.getQuestionByID():console.log(b)})},a.finishAvardedQuestions=function(b){j.post("finishAwardedQuestion",{QuestionID:b}).then(function(b){"success"==b.Status?a.getQuestionByID():console.log(b)})},a.fieldChanged=function(){a.answerTextIn=a.answerTextIn.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"');
},a.getInlineImageView=function(a){d.open({animation:!0,templateUrl:"inlineImageView.html",controller:["$scope","$uibModalInstance","link",function(a,b,c){a.link=c,a.downloadAttachment=function(){var a=g.absUrl(),b=a.indexOf("#");a.substr(0,b);window.open(c,"_blank")},a.cancel=function(){b.dismiss("cancel")}}],size:"lg",resolve:{link:function(){return a}}})},a.openAttachments=function(a){d.open({animation:!0,templateUrl:"myModalContent.html",controller:["$scope","$uibModalInstance","Attachment",function(a,b,c){a.attachment=c,a.downloadAttachment=function(){var b=g.absUrl(),c=b.indexOf("#"),d=b.substr(0,c);window.open(d+a.attachment.FullPath,"_blank")},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}],size:"md",resolve:{Attachment:function(){return a}}})},c.$on("socketDataChanged",function(){a.checkNowOnline()}),a.checkNowOnline=function(){if(a.question&&a.question.UserID){for(var b=a.socketData.OnlineUsers,c=0;c<b.length;c++)if(a.question.UserID==b[c].ID)return void(a.isOnline=!0);a.isOnline=!1}},a.saveAnswer=function(){if(!a.answerTextIn||0==a.answerTextIn.length)return void j.popError("متن خود را وارد کنید");j.setBusy(!0);var b={data:angular.toJson({QuestionID:i.id,AnswerText:a.answerTextIn})},c=k.upload({url:serviceBaseURL+"saveAnswer",method:"POST",file:a.myFiles,data:b});c.then(function(b){j.setBusy(!1),a.answerTextIn="",a.myFiles=[],a.getQuestionByID(),j.popInfo("پاسخ شما ثبت شد . در صورت تایید نمایش داده خواهد شد")},function(a){j.setBusy(!1),j.popError("مشکل در ثبت سوال سوال ، لطفا دوباره تلاش کنید!")})},a.setLikeQuestion=function(b){j.post("rateQuestion",{QuestionID:i.id,UserID:c.user.UserID,RateValue:b,TargetUserID:a.question.UserID,AuthorID:a.question.AuthorID}).then(function(b){a.getQuestionByID()})},a.setLikeAnswers=function(b,d){j.post("rateAnswer",{AnswerID:b.ID,UserID:c.user.UserID,RateValue:d,TargetUserID:b.UserID,AuthorID:b.AuthorID,QuestionID:i.id}).then(function(b){a.getQuestionByID()})},a.followQuestion=function(){j.postAsync("followQuestion",{QuestionID:i.id,UserID:c.user.UserID,AuthorID:a.question.AuthorID}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.unFollowQuestion=function(){j.postAsync("unFollowQuestion",{QuestionID:i.id,UserID:c.user.UserID}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.followPerson=function(b){j.postAsync("followPerson",{TargetUserID:b,UserID:c.user.UserID}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.unFollowPerson=function(b){j.postAsync("unFollowPerson",{TargetUserID:b,UserID:c.user.UserID}).then(function(b){"success"==b.Status&&a.getQuestionByID()})},a.removeFile=function(b){var c=a.myFiles.indexOf(b);a.myFiles.splice(c,1)},a.getBoxColor=function(a){switch(a=a%5+1){case 1:return"box-success";case 2:return"box-warning";case 3:return"box-info";case 4:return"box-primary";case 5:return"box-danger";default:return"box-success"}},a.getTagColor=function(a){switch(a=a%5+1){case 1:return"label-success";case 2:return"label-warning";case 4:return"label-primary";case 5:return"label-danger";default:return"label-success"}},a.getBGColor=function(a){switch(a=a%15+1){case 1:return"bg-red-active";case 2:return"bg-yellow-active";case 3:return"bg-aqua-active";case 4:return"bg-blue-active";case 5:return"bg-light-blue-active";case 6:return"bg-green-active";case 7:return"bg-navy-active";case 8:return"bg-teal-active";case 9:return"bg-olive-active";case 10:return"bg-lime-active";case 11:return"bg-orange-active";case 12:return"bg-fuchsia-active";case 13:return"bg-purple-active";case 14:return"bg-maroon-active";case 15:return"bg-black-active";default:return"bg-red-active"}}}]),angular.module(appName).controller("HelpCtrl",["$scope","$rootScope","$stateParams","$state","$location","$timeout","Extention","Upload",function(a,b,c,d,e,f,g,h){activeElement("#SOthers","#SHelp")}]),angular.module(appName).controller("LibraryCtrl",["$scope","$rootScope","$stateParams","$state","$location","$timeout","Extention","Upload","clipboard",function(a,b,c,d,e,f,g,h,i){a.files=[],a.pagingController={},a.childSubject={selected:null},a.tag={selected:null},a.mainSubject={selected:null},a.pagingParams={childSubjectID:null,tagID:null,mainSubjectID:null},a.tags=[],a.allChildSubjects=[],a.allSubjects=[],g.postAsync("getLibraryData",{}).then(function(b){b&&"success"==b.Status?(a.tags=b.Data.Tags,a.allSubjects=b.Data.AllSubjects):g.popError("مشکل در گرفتن اطلاعات")}),a.changeFilter=function(b){switch(b){case 1:a.pagingParams.tagID=a.tag.selected?a.tag.selected.ID:null;break;case 2:a.pagingParams.childSubjectID=a.childSubject.selected?a.childSubject.selected.ID:null;break;case 3:a.pagingParams.mainSubjectID=a.mainSubject.selected?a.mainSubject.selected.ID:null,a.mainSubject.selected?g.postAsync("getForumSubjects",{ID:a.mainSubject.selected.ID}).then(function(b){b&&"success"==b.Status?a.allChildSubjects=b.Data:g.popError("مشکل در گرفتن اطلاعات")}):a.allChildSubjects=[]}a.search()},a.search=function(){a.pagingController.update()},a.getBoxColor=function(a){switch(a=a%5+1){case 1:return"box-success";case 2:return"box-warning";case 3:return"box-info";case 4:return"box-primary";case 5:return"box-danger";default:return"box-success"}},a.downloadFile=function(a){var b=e.absUrl(),c=b.indexOf("#"),d=b.substr(0,c);window.open(d+a.FullPath,"_blank")},a.copyFileLink=function(a){var b=e.absUrl(),c=b.indexOf("#"),d=b.substr(0,c);i.copyText(d+"../"+a.AbsolutePath),g.popInfo("لینک فایل کپی شد.")},activeElement("#SLibrary","#SLibraryList")}]),angular.module(appName).controller("MainCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$log","Extention","$cookies","$uibModal",function(a,b,c,d,e,f,g,h,i,j){a.UserMessages=[],a.awardQuestion=null,a.Surveys=[],h.postAsync("checkPopUp",{}).then(function(a){if("success"===a.Status&&null!=a.Data){var b=i.get("popup");if(b)return;var c=new Date;c.setDate(c.getDate()+1),i.put("popup","true",{expires:c,path:"/"}),j.open({animation:!0,templateUrl:"popUp.html",controller:["$scope","$uibModalInstance",function(b,c){b.popup=a.Data,b.cancel=function(){c.dismiss("cancel")}}],size:"md"})}}),h.post("getAwardQuestion").then(function(b){"success"===b.Status?a.awardQuestions=b.Data:a.awardQuestions=null}),h.post("getActiveSurveys").then(function(b){"success"===b.Status?a.Surveys=b.Data:a.Surveys=[]}),a.checkNowOnline=function(){return},b.activity={low:"solid 2px #e74c3c",medium:"solid 2px #f1c40f",high:"solid 2px #2ecc71"},a.bgColorArray=["bg-aqua-active","bg-purple-active","bg-red-active","bg-navy-active","bg-orange-active","bg-blue-active","bg-green-active","bg-olive-active","bg-lime-active","bg-fuchsia-active","bg-teal-active","bg-yellow-active","bg-maroon-active","bg-light-blue-active","bg-black-active","bg-green","bg-navy","bg-teal","bg-olive","bg-lime","bg-orange","bg-fuchsia","bg-purple","bg-maroon","bg-red","bg-yellow","bg-aqua","bg-blue","bg-light-blue","bg-black"],a.pagingParams={searchValue:"",searchType:"0"},a.notificationsUpdating=!0,a.messagesUpdating=!0,h.post("getUserNotifications").then(function(b){a.notifications=b.Data,a.notificationsUpdating=!1}),h.post("getUserMessages").then(function(b){a.messages=b,a.messagesUpdating=!1}),h.post("getSiteInfo").then(function(a){b.websiteInfo=a}),a.nowDate=function(){return new Date},a.fullSearchData={SearchType:"0"},a.pagingControllerSearch={},a.search=function(){return a.pagingParams.searchValue?(a.pagingControllerSearch.update(),b.globalSearchActive=!0,void(a.pageTitle=d.current.resolve.$title())):void(b.globalSearchActive=!1)},a.searchBoxChanged=function(){!a.pagingParams.searchValue&&b.globalSearchActive&&(b.globalSearchActive=!1)},a.searchIconClass="fa-search",a.searchTypeChanges=function(b){switch(a.pagingParams.searchType=b,b){case 0:a.searchIconClass="fa-question";break;case 1:a.searchIconClass="fa-male";break;case 2:a.searchIconClass="fa-tag"}a.search()},a.backFromSearch=function(){b.globalSearchActive=!1,a.searchResult=[]},a.getRandomColorClass=function(b){var c=b%a.bgColorArray.length;return a.bgColorArray[c]},a.updateMessages=function(b){b&&b.stopPropagation(),a.messagesUpdating?h.popInfo("لطفا کمی صبر کنید..."):(a.messagesUpdating=!0,h.postAsync("getUserMessages").then(function(b){a.messages=b,a.messagesUpdating=!1}))},a.updateNotifications=function(b){b&&b.stopPropagation(),a.notificationsUpdating?h.popInfo("لطفا کمی صبر کنید..."):(a.notificationsUpdating=!0,h.postAsync("getUserNotifications").then(function(b){a.notifications=b.Data,a.notificationsUpdating=!1}))},a.markLastNotifications=function(b){b.stopPropagation(),a.notificationsUpdating?h.popInfo("لطفا کمی صبر کنید..."):(a.notificationsUpdating=!0,h.postAsync("markLastNotifications").then(function(b){a.notifications=b.Data,a.notificationsUpdating=!1}))},a.markAsReadNotification=function(b,c){b.stopPropagation();var d=a.notifications.All.indexOf(c);a.notifications.All.splice(d,1),a.notifications.Total-=1,h.postAsync("markAsReadNotification",{EventID:c.EventID}).then(function(a){})},a.markAsReadMessage=function(b,c){b.stopPropagation();var d=a.messages.All.indexOf(c);a.messages.All.splice(d,1),a.messages.Total-=1,h.postAsync("markAsReadMessage",{MessageID:c.ID}).then(function(a){})}}]),angular.module(appName).controller("MessageCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$stateParams","$uibModal","Extention",function(a,b,c,d,e,f,g,h,i){a.showInbux=!1,a.showSendMessage=!1,a.showReciveMessage=!0,a.dropDwonTitle="نمایش پیام ها",a.user={},a.pagingController={},a.user.selectedUser=[],a.users=[],a.Message={},a.Messages=[],a.all={},a.checkAll=function(){if(a.all.checked)for(var b=0;b<a.Messages.length;b++)a.Messages[b].checked=!0},a.clearMiniSpace=function(){a.Message.MessageIn=a.Message.MessageIn.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},a.getPersons=function(b){console.log(b),i.postAsync("getUsersByName",{filter:b}).then(function(b){b&&"success"==b.Status?a.users=b.Data:i.popError("مشکل در اتصال.")})},a.sentMessage=function(b){0!=a.user.selectedUser.length&&a.Message.MessageIn&&a.Message.MessageTitle&&(1==b?a.Message.MessageType=1:a.Message.MessageType=0,a.Message.Message=a.Message.MessageIn.replace(/\r\n|\r|\n/g,"<br />"),i.post("sendMessage",{Message:a.Message,Users:a.user.selectedUser}).then(function(b){b&&"success"==b.Status?(a.user.selectedUser=[],i.popSuccess("پیام های شما ارسال شد"),a.showInbux=!0,a.showSendMessage=!1,a.showReciveMessage=!1):i.popError("مشکل در اتصال.")},function(a){console.log(a)}))},a.changeTypeFilter=function(b){switch(a.pagingParams.MessageType=b,b){case null:a.dropDwonTitle="همه ی پیام ها";break;case 1:a.dropDwonTitle="پیام های ایمیلی";break;case 0:a.dropDwonTitle="پیام های مستقیم";break;default:a.dropDwonTitle="نمایش پیام ها"}a.search()},a.search=function(){a.pagingController.update()},a.showMessage=function(b){0==b.MessageViewed&&i.postAsync("markAsReadMessage",{MessageID:b.ID}).then(function(b){for(var c=0;c<a.message.all.length;c++)if(a.message.all[c].ID==b.Data){a.message.all[c].MessageViewed=1;break}for(var d=a.$parent.messages.All,c=0;c<d.length;c++)if(d[c].ID==b.Data){d.splice(c,1);var d=a.$parent.messages.Total-=1;break}}),h.open({animation:!0,templateUrl:"messageModal.html",controller:["$scope","$uibModalInstance","Message",function(a,c,e){a.message=e,a.getAdmin=function(){d.go("UserProfile",{id:b.SenderUserID}),c.dismiss("cancel")},a.cancel=function(){c.dismiss("cancel")}}],size:"md",resolve:{Message:function(){return b}}})},a.openMessageModal=function(a){h.open({animation:!0,templateUrl:"Message1Modal.html",controller:["$scope","$uibModalInstance",function(b,c){b.message=a,console.log(b.message),b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},activeElement("#SMessage")}]),angular.module(appName).controller("AnswersCtrl",["$scope","$element","$rootScope","$routeParams","$state","$location","$timeout","Extention","Upload","$uibModal",function(a,b,c,d,e,f,g,h,i,j){a.pagingController={},a.selectedAnswer=null,a.ShowEdit=!1,a.deleteAnswer=function(b){console.log(b),h.post("deleteMyAnswer",{AnswerID:b.ID}).then(function(b){"success"==b.Status&&a.pagingController.update()})},a.editAnswer=function(b){a.ShowEdit=!0,a.answerTextIn=b.AnswerText,a.selectedAnswer=b},a.openAnswerModal=function(a){j.open({animation:!0,templateUrl:"answerModal.html",controller:["$scope","$uibModalInstance",function(b,c){b.answer=a,b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},a.fieldChanged=function(){a.answerTextIn=a.answerTextIn.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},a.saveAnswer=function(){if(!a.answerTextIn||0==a.answerTextIn.length)return void h.popError("متن خود را وارد کنید");h.setBusy(!0);var b={data:angular.toJson({AnswerID:a.selectedAnswer.ID,AnswerText:a.answerTextIn})},c=i.upload({url:serviceBaseURL+"updateAnswer",method:"POST",file:a.myFiles,data:b});c.then(function(b){h.setBusy(!1),a.answerTextIn="",a.myFiles=[],a.ShowEdit=!1,a.pagingController.update(),h.popInfo("پاسخ شما تغییر کرد . در صورت تایید نمایش داده خواهد شد")},function(a){h.setBusy(!1),h.popError("مشکل در تغییر جواب سوال ، لطفا دوباره تلاش کنید!")})},activeElement("#SQuestion","#SAnswers")}]),angular.module(appName).controller("FollowCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention",function(a,b,c,d,e,f){a.pagingParams={},a.pcfPerson={},a.pcfQuestion={},a.pcfMainSubject={},a.pcfSubject={},a.follow={},a.getTab=function(b){var c={location:!0,inherit:!0,relative:d.$current,notify:!1};d.transitionTo("my_following",{action:b},c),a.pagingParams.FollowType=b,a.activeTab=b,a.updateView(b)},a.removeFollow=function(b,c){f.post("deleteFollow",{FollowType:c,ID:b}).then(function(b){b&&"success"===b.Status?(f.popSuccess("با موفقیت حذف شد!"),a.updateView(b.Data)):f.popError("خطا لطفا دوباره امتحان کنید.")})},a.updateView=function(b){switch(b){case"Person":a.pcfPerson.update();break;case"Question":a.pcfQuestion.update();break;case"MainSubject":a.pcfMainSubject.update();break;case"Subject":a.pcfSubject.update()}},e(function(){c.action?a.getTab(c.action):a.getTab("Person")}),activeElement("#SFollowers")}]),angular.module(appName).controller("NewQuestionCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f,g){a.question={},a.allTags=[],a.allSubjects=[],a.errForum={},a.errForum.title=!1,a.errForum.text=!1,a.form={},a.att={},c.id?(a.question.ID=c.id,a.form.header="ویرایش سوال",a.form.submitButton="ویرایش سوال",f.post("getQuestionMetaEdit",{QuestionID:a.question.ID}).then(function(b){a.allTags=b.AllTags,a.allSubjects=b.AllSubjects,a.question=b.Question,a.QuestionTextIN=b.Question.QuestionText,e(function(){for(var c=a.question.MainSubject,d=0;d<b.AllSubjects.length;d++)if(c.SubjectID==b.AllSubjects[d].SubjectID){a.question.MainSubject=b.AllSubjects[d];break}a.allChildSubjects=a.question.MainSubject.Childs})}),e(function(){b.$title="ویرایش سوال"})):(a.form.header="ایجاد سوال جدید",a.form.submitButton="ارسال سوال به انجمن",f.post("getQuestionMetaEdit").then(function(b){a.allTags=b.AllTags,a.allSubjects=b.AllSubjects})),a.saveQuestion=function(){var b=!1;if(a.question.Title||(a.errForum.title=!0,b=!0),a.QuestionTextIN||(a.errForum.text=!0,b=!0),a.question.QuestionText=a.QuestionTextIN,a.question.MainSubject||(a.errForum.mainSubject=!0,b=!0),a.question.Subject||(a.errForum.subject=!0,b=!0),b)return void f.popError("لطفا فرم سوال را به طور کامل پر کنید!");if(a.question.ID)f.post("editQuestion",a.question).then(function(a){a?"success"==a.Status?f.popSuccess("سوال با موفقیت تغییر کرد."):"CanNotEdit"==a.Status?f.popError("<b>خطا در تغییر محتوای سوال!<b><br> تغییرات فقط تا زمانی که سوال در انتظار تایید است مقدور میباشد. ",12e3):"Deleted"==a.Status?f.popError("خطا ، این سوال وجود ندارد.",12e3):f.popError("خطا در ارتباط با سرور ، لطفا دوباره تلاش کنید."):f.popError("خطا در ارتباط با سرور ، لطفا دوباره تلاش کنید.")});else{f.setBusy(!0);var c=g.upload({url:serviceBaseURL+"saveQuestion",method:"POST",file:a.att.myFiles,data:{formData:angular.toJson(a.question)}});c.then(function(b){f.setBusy(!1),f.popSuccess("سوال شما با موفقیت ارسال شد!"),a.emptyForm()},function(a){f.setBusy(!1),f.popError("مشکل در ثبت سوال سوال ، لطفا دوباره تلاش کنید!")})}},a.emptyForm=function(){a.question={},a.att.myFiles=[],a.QuestionTextIN=void 0},a.fieldChanged=function(b,c){a.errForum[b]=void 0==c||""==c,a.QuestionTextIN=a.QuestionTextIN.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},a.subjectChanged=function(){a.errForum.mainSubject=!1,a.allChildSubjects=a.question.Subject=void 0,e(function(){a.allChildSubjects=a.question.MainSubject.Childs})},a.childSubjectChanged=function(){a.errForum.subject=!1},a.filesChanged=function(b,c,d,e,f,g){a.att.myFiles},a.removeFile=function(b){var c=a.att.myFiles.indexOf(b);a.att.myFiles.splice(c,1)},activeElement("#SQuestion","#SQuestionNew")}]),angular.module(appName).controller("QuestionsCtrl",["$scope","$element","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g,h){a.pagingController={},a.removeQuestion=function(b){h.post("deleteQuestion",{QuestionID:b}).then(function(b){b&&"success"==b.Status?(h.popSuccess("سوال با موفقیت حذف شد !"),a.pagingController.update()):h.popError("مشکل در حذف سوال ، لطفا دوباره تلاش کنید.")})},a.getQuestion=function(a){1==a.AdminAccepted&&e.go("question",{id:a.ID})},activeElement("#SQuestion","#SQuestions")}]),angular.module(appName).controller("UploadLibraryCtrl",["$scope","$rootScope","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f){a.allTags=[],a.isResumeSupported=f.isResumeSupported(),e.post("getUploadLibraryData").then(function(b){a.pageData=b,a.allTags=b.Tags}),a.subjectChanged=function(a){a.allChildSubjects=void 0,a.Subject=void 0,d(function(){a.allChildSubjects=a.MainSubject.Childs})},a.togglePauseUploadFile=function(a){a.uploader.pause()},a.removeFile=function(b){if(0==b.uploadState)b.uploader.abort(),b.percent="0";else{var c=a.myFiles.indexOf(b);a.myFiles.splice(c,1)}},a.startUploadAll=function(){if(a.myFiles&&a.myFiles.length){for(var b=0,c=0;c<a.myFiles.length;c++){var d=a.myFiles[c];1!=d.uploadState?a.startUploadFile(d):b++}b==a.myFiles.length&&e.popInfo("تمامی فایل ها آپلود شده اند!")}else e.popInfo("هیچ فایلی برای آپلود انتخاب نشده!")},a.startUploadFile=function(b){if(0!=b.uploadState){b.uploadState=0;var c=void 0,d=void 0;angular.isDefined(b.MainSubject)&&(d=b.MainSubject.SubjectID),angular.isDefined(b.Subject)&&(c=b.Subject.ID),console.log({file:b,Description:b.Description,SubjectID:c,MainSubjectID:d,Title:b.Title,Tags:b.Tags}),b.uploader=f.upload({url:uploadURL+"upload_library.php",data:{file:b,Description:b.Description,SubjectID:c,MainSubjectID:d,Title:b.Title,Tags:b.Tags}}),b.uploader.then(function(a){a.config.data.file.uploadState=1,console.log("Success "+a.config.data.file.name+"uploaded. Response: "+a.data)},function(a){a.config.data.file.uploadState=2,a.status==-1&&(a.config.data.file.percent=0),console.log("Error status: "+a.status)},function(b){var c=parseInt(100*b.loaded/b.total);b.config.data.file.percent=c,b.config.data.file.loaded=a.sizeFilter(b.loaded)})}};var g=["B","KB","MB","GB","TB","PT"];a.sizeFilter=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return persianJs((a/Math.pow(1024,Math.floor(b))).toFixed(1)).englishNumber().toString()+" "+g[b]},a.abortUpload=function(a){a.uploader.abort()},a.isImageFormat=function(a){var b=a.indexOf("image");return b>-1},activeElement("#SLibrary","#SLibraryUpload")}]),angular.module(appName).controller("ProfileCtrl",["$scope","$rootScope","$stateParams","$state","$uibModal","$timeout","Extention","Upload",function(a,b,c,d,e,f,g,h){if(a.Position={selected:null},a.education={selected:null},a.educationLevel={selected:null},a.jobRecord={selected:null},a.JobInfo={selected:null},a.Job={selected:null},a.Depo={selected:null},a.AssessmentPosition={selected:null},a.Assessment={},a.AssessmentJobInfo=null,a.SystemExperience=[],a.SystemExperienceDef=[],a.page={AllEducations:[],AllEducationLevels:[],AllJobRecords:[],AllPositions:[],Depos:[],AllJobs:[],AssessmentJobInfo:[]},a.Positions={items:[]},a.HaveAssessment=!1,a.removeItem=function(b,c){1==b?a.page.AssessmentJobInfo.splice(c,1):2==b&&a.page.SystemExperience.splice(c,1)},a.getDepo=function(){a.AssessmentPosition.selected?g.postAsync("getPositionDepos",{PositionID:a.AssessmentPosition.selected.ID}).then(function(b){if(b&&"success"==b.Status&&(a.page.Depos=b.Data,a.Assessment.DepoID))for(var c=0;c<a.page.Depos.length;c++)if(a.page.Depos[c].ID==a.Assessment.DepoID){a.Depo.selected=a.page.Depos[c];break}}):a.Depo.selected=null},a.updateAssessment=function(b){if(1==b){if(!a.education.selected)return void g.popWarning("رشته ی تحصیلی را انتخاب کنید");if(!a.Assessment.AssessmentEducationName&&"10000"==a.education.selected.ID)return void g.popWarning("رشته ی تحصیلی را وارد کنید");if(!a.educationLevel.selected)return void g.popWarning("مدرک تحصیلی را انتخاب کنید");if(!a.jobRecord.selected)return void g.popWarning("مدت سابقه کار در ارتباطات را انتخاب کنید");if(!a.Assessment.BrithDate)return void g.popWarning("تاریخ تولد خود را وارد کنید");if(!a.AssessmentPosition.selected)return void g.popWarning("ناحیه فعلی مشغول به کار را انتخاب کنید");a.Assessment.DepoID=a.Depo.selected?a.Depo.selected.ID:null,a.Assessment.AssessmentEducationID=a.education.selected.ID,a.Assessment.AssessmentEducationLevelID=a.educationLevel.selected.ID,a.Assessment.JobRecordID=a.jobRecord.selected.ID,a.Assessment.Positions=a.Positions.items,a.Assessment.CurrentPositionID=a.AssessmentPosition.selected.ID,a.Assessment.type=b,g.post("insertOrUpdateAssessment",a.Assessment).then(function(b){return b&&"success"==b.Status?(a.HaveAssessment=!0,void g.popSuccess("اطلاعات ذخیره شد")):void console.log(b)})}else if(2==b){var c={jobs:a.page.AssessmentJobInfo,type:b};g.post("insertOrUpdateAssessment",c).then(function(a){return a&&"success"==a.Status?void g.popSuccess("اطلاعات ذخیره شد"):void console.log(a)})}else if(3==b){for(var c={jobsExpDef:[],jobsExpDef2:[],type:b},d=0;d<a.page.SystemExperienceDef.length;d++)a.page.SystemExperienceDef[d].SystemName&&a.page.SystemExperienceDef[d].SystemType&&a.page.SystemExperienceDef[d].TrainingTime&&a.page.SystemExperienceDef[d].SelfScore&&c.jobsExpDef.push(a.page.SystemExperienceDef[d]);for(var d=0;d<a.page.SystemExperience.length;d++)c.jobsExpDef2.push({SystemName:a.page.SystemExperience[d].SystemName,SystemType:a.page.SystemExperience[d].SystemType,TrainingTime:a.page.SystemExperience[d].TrainingTime,SelfScore:a.page.SystemExperience[d].SelfScore,Description:a.page.SystemExperience[d].Description});g.post("insertOrUpdateAssessment",c).then(function(a){if(console.log(a),a&&"success"==a.Status)return void g.popSuccess("اطلاعات ذخیره شد")},function(a){console.log(a)})}},a.addNewJobExp=function(b){return b.SystemName?b.SystemType?b.TrainingTime?b.SelfScore?(a.page.SystemExperience.push(b),void(a.SystemExperience={})):void g.popWarning("امتیازخود را انتخاب کنید"):void g.popWarning("مدت دوره را انتخاب کنید"):void g.popWarning("دستگاه را انتخاب کنید"):void g.popWarning("نام سیستم را انتخاب کنید")},a.addNewJobInfo=function(b){return a.JobInfo.selected?a.Job.selected?a.endDate?a.startDate?(b.StartDate=a.startDate,b.EndDate=a.endDate,b.OrganPositionID=a.JobInfo.selected.ID,b.JobInfo={selected:a.JobInfo.selected},b.JobID=a.Job.selected.ID,b.Job={selected:a.Job.selected},a.page.AssessmentJobInfo.push(b),a.AssessmentJobInfo={},a.JobInfo.selected=null,a.Job.selected=null,a.startDate=null,void(a.endDate=null)):void g.popWarning("تاریخ شروع را وارد کنید"):void g.popWarning("\tتاریخ پایان را وارد کنید"):void g.popWarning("عنوان شغلی را انتخاب کنید"):void g.popWarning("ناحیه را انتخاب کنید")},g.postAsync("getAllPositions",{}).then(function(b){var c;a.Position.selected&&(c=a.Position.selected),a.allPositions=b,a.Position.selected=c}),g.postAsync("getAssessmentData",{}).then(function(b){console.log(b),a.page.AllEducations=b.Data.AllEducations,a.page.AllEducationLevels=b.Data.AllEducationLevels,a.page.AllJobRecords=b.Data.AllJobRecords,a.page.AllPositions=b.Data.AllPositions,a.page.AllJobs=b.Data.AllJobs;for(var c=0;c<b.Data.SystemExperienceDef.length;c++)b.Data.SystemExperienceDef[c].SelfScore=Number(b.Data.SystemExperienceDef[c].SelfScore),b.Data.SystemExperienceDef[c].TrainingTime=Number(b.Data.SystemExperienceDef[c].TrainingTime);for(var c=0;c<b.Data.SystemExperience.length;c++)b.Data.SystemExperience[c].SelfScore=Number(b.Data.SystemExperience[c].SelfScore),b.Data.SystemExperience[c].TrainingTime=Number(b.Data.SystemExperience[c].TrainingTime);a.page.SystemExperienceDef=b.Data.SystemExperienceDef,a.page.SystemExperience=b.Data.SystemExperience;for(var d=0;d<b.Data.AssessmentJobInfo.length;d++){for(var c=0;c<a.page.AllPositions.length;c++)if(a.page.AllPositions[c].ID==b.Data.AssessmentJobInfo[d].OrganPositionID){a.JobInfo.selected=a.page.AllPositions[c];break}for(var c=0;c<a.page.AllJobs.length;c++)if(a.page.AllJobs[c].ID==b.Data.AssessmentJobInfo[d].JobID){a.Job.selected=a.page.AllJobs[c];break}a.startDate=Number(b.Data.AssessmentJobInfo[d].StartDate),a.endDate=Number(b.Data.AssessmentJobInfo[d].EndDate),a.addNewJobInfo(b.Data.AssessmentJobInfo[d])}if(b.Data.Assessment){a.HaveAssessment=!0,a.Assessment.JobExperience=b.Data.Assessment.JobExperience,a.Assessment.BrithDate=Number(b.Data.Assessment.BrithDate),a.Assessment.AssessmentEducationName=b.Data.Assessment.AssessmentEducationName,a.Assessment.DepoID=b.Data.Assessment.DepoID;for(var c=0;c<a.page.AllEducations.length;c++)if(a.page.AllEducations[c].ID==b.Data.Assessment.AssessmentEducationID){a.education.selected=a.page.AllEducations[c];break}for(var c=0;c<a.page.AllEducationLevels.length;c++)if(a.page.AllEducationLevels[c].ID==b.Data.Assessment.AssessmentEducationLevelID){a.educationLevel.selected=a.page.AllEducationLevels[c];break}for(var c=0;c<a.page.AllJobRecords.length;c++)if(a.page.AllJobRecords[c].ID==b.Data.Assessment.JobRecordID){a.jobRecord.selected=a.page.AllJobRecords[c];break}for(var c=0;c<a.page.AllPositions.length;c++)if(a.page.AllPositions[c].ID==b.Data.Assessment.CurrentPositionID){a.AssessmentPosition.selected=a.page.AllPositions[c];break}for(var d=0;d<b.Data.AssessmentPositions.length;d++)for(var c=0;c<a.page.AllPositions.length;c++)if(b.Data.AssessmentPositions[d].OrganPositionID==a.page.AllPositions[c].ID){a.Positions.items.push(a.page.AllPositions[c]);break}a.getDepo()}}),a.checkDate=function(b){a.Assessment.BrithDate>1380?(a.Assessment.BrithDate=1380,g.popWarning("تاریخ شما باید عددی کمتر از سال 1380 باشد")):a.Assessment.BrithDate<1340&&(a.Assessment.BrithDate=1340,g.popWarning("تاریخ شما باید عددی بیشتر از سال 1340 باشد"))},a.onChangeAvatar=function(a,c){0!=a.length&&e.open({animation:!0,templateUrl:"cropModal.html",controller:["$scope","$uibModalInstance","file",function(a,c,e){if(a.croppedImage={},a.cancel=function(){c.dismiss()},null!=e){var i=new FileReader;i.onload=function(b){a.$apply(function(a){a.myImage=b.target.result})},i.readAsDataURL(e)}a.changeAvatar=function(){g.setBusy(!0);var e=function(a){for(var b=atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=[],e=0;e<b.length;e++)d.push(b.charCodeAt(e));return new Blob([new Uint8Array(d)],{type:c})},i=e(a.croppedImage);i.name="cropfile.png",i.upload=h.upload({url:serviceBaseURL+"updateAvatar",data:{file:i}}),a.uploading=!0,g.popInfo("لطفا تا پایان تغییر تصویر صبر کنید."),i.upload.then(function(a){f(function(){g.popSuccess("تصویر با موفقیت تغییر کرد!"),g.setBusy(!1),session.Image=a.data.Image,b.user.Image=a.data.Image,d.go("profile",{},{reload:!0}),c.dismiss()})},function(a){a.status>0?g.popError("مشکل در تغییر تصویر پروفایل"):g.popSuccess("تصویر با موفقیت تغییر کرد!"),g.setBusy(!1),d.go("profile",{},{reload:!0})},function(a){i.progress=Math.min(100,parseInt(100*a.loaded/a.total))})}}],size:"md",resolve:{file:function(){return c}}})},a.timelinePagingController={},c.action)switch(c.action){case"Timeline":f(function(){a.timelinePagingController.update()}),a.activeTab=0;break;case"Sessions":a.activeTab=1;break;case"Info":a.activeTab=2;break;case"AddentionalInfo":a.activeTab=3;break;case"Assessment":a.activeTab=4}else a.activeTab=2;a.bgColorArray=["bg-aqua-active","bg-blue-active","bg-green-active","bg-yellow-active","bg-maroon-active","bg-light-blue-active","bg-green","bg-orange","bg-purple","bg-red","bg-yellow","bg-light-blue"],a.getRandomColorClass=function(b){var c=b%a.bgColorArray.length;return a.bgColorArray[c]},a.getIconClass=function(a){switch(a.EventTypeID){case"-1":return"fa-user-plus ipalette-bg-sun-flower";case"1":case"2":return"fa-star ipalette-bg-sun-flower";case"3":return"fa-check ipalette-bg-peter-river";case"4":return"fa-flask  ipalette-bg-pomegranate";case"5":return"fa-envelope  ipalette-bg-pumpkin";case"6":return"fa-user  ipalette-bg-emerald";case"7":return"fa-eye ipalette-bg-pomegranate";case"8":return"fa-hand-pointer-o ipalette-bg-alizarin";case"9":return"fa-comments ipalette-bg-amethyst";case"10":return"fa-check ipalette-bg-green-sea";case"11":return"fa-flask ipalette-bg-orange";default:return"fa-clone ipalette-bg-orange"}},a.getTab=function(b){a.activeTab=b;var c={location:!0,inherit:!0,relative:d.$current,notify:!1};switch(a.activeTab){case 0:d.transitionTo("profile",{action:"Timeline"},c),a.timelinePagingController.update();break;case 1:d.transitionTo("profile",{action:"Sessions"},c);break;case 2:d.transitionTo("profile",{action:"Info"},c);break;case 3:d.transitionTo("profile",{action:"AddentionalInfo"},c);break;case 4:d.transitionTo("profile",{action:"Assessment"},c)}},a.isEqualWithVerify=!0,a.getUser=function(){g.post("getUserProfile").then(function(b){a.curUser=b,a.Position.selected=b.Organ})},a.getUser(),a.getRandomSpan=function(){var a=Math.floor(6*Math.random()+1);switch(a){case 1:return"danger";case 2:return"success";case 3:return"info";case 4:return"warning";case 5:return"primary"}},a.saveUserInfo=function(){return a.curUser.Password&&a.curUser.VerifyPassword!=a.curUser.Password||a.curUser.VerifyPassword&&a.curUser.VerifyPassword!=a.curUser.Password?void g.popError("رمز وارد شده با تکرار آن یکسان نیست!"):a.curUser.Password&&a.curUser.Password.length<5?void g.popError(persianJs("رمز جدید بایستی حداقل 5 کاراکتر باشد!").englishNumber().toString()):(a.curUser.OrganizationID=a.Position.selected.ID,void g.post("saveUserInfo",a.curUser).then(function(c){c&&"success"==c.Status?(g.popSuccess("با موفقیت تغییر کرد!"),session.FullName=c.FullName,b.user.FullName=c.FullName,a.curUser.Password=void 0,a.curUser.VerifyPassword=void 0,a.curUser.OldPassword=void 0):"EmailExists"==c.Message?g.popWarning("خطا : این ایمیل قبلا ثبت شده ، لطفا ایمیل دیگری انتخاب کنید.",12e3):"OldPasswordIsNotValid"==c.Message?g.popError("خطا : رمز عبور فعلی اشتباه است."):"PasswordIsNotValid"==c.Message?g.popError(persianJs("خطا : رمز عبور جدید بایستی حداقل 5 کاراکتر باشد.").englishNumber().toString()):(console.log(c),g.popError("مشکل در تغییر اطلاعات ، لطفا دوباره تلاش کنید."))}))},a.saveUserAddintionalInfo=function(){g.post("saveUserAddintionalInfo",a.curUser).then(function(a){a&&"success"==a.Status?g.popSuccess("با موفقیت تغییر کرد!"):g.popError("مشکل در تغییر اطلاعات ، لطفا دوباره تلاش کنید.")})},a.passwordChanged=function(){return a.curUser.Password||a.curUser.VerifyPassword?void(a.isEqualWithVerify=a.curUser.VerifyPassword==a.curUser.Password):void(a.isEqualWithVerify=!0)},a.randomClass=["danger","info","success","warning"],a.randomColor=function(b){return a.randomClass[b%a.randomClass.length]},a.removeSession=function(b){g.post("deleteSession",{ID:b}).then(function(b){b?"success"==b.Status?(g.popSuccess("اتصال با موفقیت قطع شد."),a.getUser()):"CurrentSession"==b.Message?g.popInfo("مشکل در قطع اتصال ، شما با این شناسه متصل هستید!"):g.popError("مشکل در قطع اتصال ، لطفا دوباره تلاش کنید."):g.popError("مشکل در قطع اتصال ، لطفا دوباره تلاش کنید.")})},a.setAsContractor=function(b){b&&g.post("changeUserContractor",{UserID:b,
Contractor:1}).then(function(b){"success"==b.Status?(a.curUser.IsContractor=1,g.popInfo("وضعیت شما به پیمانکار تغییر کرد")):g.popError("مشکل در تغییر وضعیت . لطفا دوباره امتحان کنید")})},a.setAsNotContractor=function(b){b&&g.post("changeUserContractor",{UserID:b,Contractor:0}).then(function(b){"success"==b.Status?(a.curUser.IsContractor=0,g.popInfo("وضعیت شما به ثبت رسید")):g.popError("مشکل در تغییر وضعیت . لطفا دوباره امتحان کنید")})},activeElement("#SProfile")}]),angular.module(appName).controller("SurveyCtrl",["$scope","$rootScope","$stateParams","$state","$location","$timeout","Extention","Upload",function(a,b,c,d,e,f,g,h){a.SurveyID=c.id,a.Survey={},a.getSurvey=function(){g.postAsync("getSurvey",{SurveyID:a.SurveyID}).then(function(b){"success"==b.Status?a.Survey=b.Data:a.Survey={}})},a.getSurvey(),a.checkForAnswer=function(){var b=!0;for(var c in a.Survey.Options)if("true"==a.Survey.Options[c].answered)return!1;return b},a.SelectOptione=function(b,c){g.post("selectSurveyOption",{SurveyID:b,OptionID:c}).then(function(b){console.log(b),"success"==b.Status&&(g.popSuccess("نظر شما ثبت شد"),a.getSurvey())})},a.removeFromSelected=function(b,c){g.post("removeSurveyOption",{SurveyID:b,OptionID:c}).then(function(b){console.log(b),"success"==b.Status&&(g.popInfo("نظر شما حذف شد"),a.getSurvey())})},a.getProgressValueStyle=function(a,b){var c=Number(b),d=Number(a);return 0==c?0:d/c*100},a.getProgresColor=function(a){switch(a=a%5+1){case 1:return"progress-bar-green";case 2:return"progress-bar-danger";case 3:return"progress-bar-info";case 4:return"progress-bar-warning";case 5:return"progress-bar-primary";default:return"progress-bar-yellow"}},activeElement("#SSurvey","#SSurvey"+a.SurveyID)}]),angular.module(appName).controller("UserProfileCtrl",["$scope","$rootScope","$routeParams","$state","$location","$stateParams","Extention",function(a,b,c,d,e,f,g){a.isOnline=!1,a.profile={},a.userID=f.id,g.post("getProfile",{TargetUserID:a.userID}).then(function(c){"success"==c.Status?(a.profile=c.Data,b.breadcrumbs=[],b.breadcrumbs.push({title:"خانه",url:"home.php",icon:"fa-home"}),b.breadcrumbs.push({title:" پروفایل '"+c.Data.FullName+"'"})):a.profile=null}),b.$on("socketDataChanged",function(){a.checkNowOnline()}),a.followPerson=function(){g.postAsync("followPerson",{TargetUserID:a.userID,UserID:b.user.UserID}).then(function(b){"success"==b.Status&&(a.profile.PersonFollow=1)})},a.unFollowPerson=function(){g.postAsync("unFollowPerson",{TargetUserID:a.userID,UserID:b.user.UserID}).then(function(b){"success"==b.Status&&(a.profile.PersonFollow=0)})},a.checkNowOnline=function(){if(void 0!=a.socketData){for(var b=a.socketData.OnlineUsers,c=0;c<b.length;c++)if(a.userID==b[c].ID)return void(a.isOnline=!0);a.isOnline=!1}},a.checkNowOnline(),a.incrementChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"IQuestionCount",fillColors:"#00BBCC",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"IAnswerCount",fillColors:"#e74c3c",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],a.dailyChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"QuestionCount",fillColors:"#00BBCC",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"AnswerCount",fillColors:"#e74c3c",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],activeElement("#SProfile")}]);