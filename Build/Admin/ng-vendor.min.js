/*
 sepanta 2017-03-01 
*/
var appName="adminApp",uploadURL="../api/upload/",serviceBaseURL="../api/admin/",debugMode=!1,app=angular.module(appName,["ngRoute","treasure-overlay-spinner","ui.router","angular-confirm","oc.lazyLoad","ngAnimate","toaster","ui.bootstrap","ui.router.title","ui.select","ngPersian","ngFileUpload","anim-in-out","am-charts","ADM-dateTimePicker","ngSanitize","ngCookies","ngCsv","textAngular"]);app.config(["$provide","$stateProvider","$urlRouterProvider","$ocLazyLoadProvider","ADMdtpProvider",function(a,b,c,d,e){d.config({debug:debugMode,events:!0}),e.setOptions({calType:"jalali",format:"YYYY/MM/DD hh:mm"}),b.state("dashboard",{url:"/dashboard",templateUrl:"angular.partial.Dashboard.html",controller:"DashboardCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"داشبورد"}}}).state("tag",{url:"/tag",templateUrl:"angular.partial.Tag.html",controller:"TagCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت تگ"}}}).state("education",{url:"/education",templateUrl:"angular.partial.Education.html",controller:"EducationCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت تحصیلات"}}}).state("all_users",{url:"/all_users",templateUrl:"angular.partial.AllUsers.html",controller:"AllUsersCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../app/directives/auto-pagination.js"])}],$title:function(){return"مدیریت اعضا"}}}).state("all_admins",{url:"/all_admins",templateUrl:"angular.partial.AllAdmins.html",controller:"AllAdminsCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../app/directives/auto-pagination.js"])}],$title:function(){return"مدیریت مدیران"}}}).state("answers",{url:"/answers/:id",templateUrl:"angular.partial.Answers.html",controller:"AnswersCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../app/directives/auto-pagination.js"])}],$title:function(){return"مدیریت جواب ها"}}}).state("questions",{url:"/questions/:id",templateUrl:"angular.partial.Questions.html",controller:"QuestionsCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../app/directives/auto-pagination.js"])}],$title:function(){return"مدیریت سوال ها"}}}).state("award_questions",{url:"/AwardQuestions",templateUrl:"angular.partial.AwardQuestions.html",controller:"AwardQuestionsCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load(["../app/directives/auto-pagination.js"])}],$title:function(){return"مدیریت سوال های جایزه دار"}}}).state("message",{url:"/message/:id",templateUrl:"angular.partial.Message.html",controller:"MessageCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"ارسال پیام"}}}).state("skill",{url:"/skill",templateUrl:"angular.partial.Skill.html",controller:"SkillCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت مهارت ها"}}}).state("upload_library",{url:"/UploadLibrary",templateUrl:"angular.partial.UploadLibrary.html",controller:"UploadLibraryCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"آپلود فایل"}}}).state("common_messages",{url:"/CommonMessage",templateUrl:"angular.partial.CommonMessage.html",controller:"CommonMessageCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"پیام های رایج"}}}).state("manage_library",{url:"/ManageLibrary",templateUrl:"angular.partial.ManageLibrary.html",controller:"ManageLibraryCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت فایل ها"}}}).state("new_admin_post",{url:"/NewAdminPost/:id",templateUrl:"angular.partial.NewAdminPost.html",controller:"NewAdminPostCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مطلب ادمین جدید"}}}).state("admin_post",{url:"/AdminPost",templateUrl:"angular.partial.AdminPost.html",controller:"AdminPostCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مطلب ادمین"}}}).state("award_question",{url:"/AwardQuestion/:id",templateUrl:"angular.partial.AwardQuestion.html",controller:"AwardQuestionCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"سوال جایزه دار"}}}).state("reporting",{url:"/Reporting",templateUrl:"angular.partial.Reporting.html",controller:"ReportingCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"گزارش گیری"}}}).state("organ_report",{url:"/OrganReporting",templateUrl:"angular.partial.OrganReporting.html",controller:"OrganReportingCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"گزارش گیری"}}}).state("new_popup",{url:"/NewPopUp:id",templateUrl:"angular.partial.NewPopUp.html",controller:"NewPopUpCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"پاپ آپ جدید"}}}).state("popup_manager",{url:"/PopUpManager",templateUrl:"angular.partial.PopUpManager.html",controller:"PopUpManagerCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت پاپ آپ"}}}).state("new_survey",{url:"/NewSurvey:id",templateUrl:"angular.partial.NewSurvey.html",controller:"NewSurveyCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"نظرسنجی جدید"}}}).state("survey_manager",{url:"/SurveyManager",templateUrl:"angular.partial.SurveyManager.html",controller:"SurveyManagerCtrl",resolve:{deps:["$ocLazyLoad",function(a){return a.load([])}],$title:function(){return"مدیریت نظرسنجی"}}}),a.decorator("taOptions",["taRegisterTool","$uibModal","$delegate",function(a,b,c){return c.toolbar=[["h1","h4","h6","p","pre","quote"],["html","customInsertImage","insertLink","wordcount","charcount"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["dirLtr","dirRtl"]],a("dirLtr",{iconclass:"fa fa-indent",action:function(){return this.$editor().wrapSelection("formatBlock",'<P style="direction:ltr">')}}),a("dirRtl",{iconclass:"fa fa-dedent",action:function(){return this.$editor().wrapSelection("formatBlock",'<P style="direction:rtl">')}}),a("customInsertImage",{iconclass:"fa fa-picture-o",action:function(a){var c=this,d=rangy.saveSelection(),e=b.open({templateUrl:"../js/text-angular/CustomSelectImageModal.tmpl.html",size:"md",controller:["$uibModalInstance","$scope","Upload","$state",function(a,b,c,d){b.activeTab=0,b.img={url:""},b.submit=function(){a.close(b.img.url)},b.cancel=function(){a.close()},b.getTab=function(a){b.activeTab=a},b.addImageLink=function(b){a.close(b)},b.filesChanged=function(b,e){var f=uploadURL;f+="upload_inline_attachment.php";var g={file:e};g.Type=d.current.name,e.uploader=c.upload({url:f,data:g}),e.uploader.then(function(b){a.close(b.data),console.log("Success "+b.config.data.file.name+"uploaded. Response: "+b.data)},function(a){console.log("Error status: "+a.status)},function(a){var b=parseInt(100*a.loaded/a.total);a.config.data.file.percent=b})},b.stopUploadImage=function(a){a.uploader.abort()}}]});return e.result.then(function(b){if(b){rangy.restoreSelection(d);var e='<a href="'+b+'" target="_blank"><img class="img-responsive link attachment-inline-img"  src="'+b+'"  /></a>';c.$editor().wrapSelection("insertHtml",e),a.resolve()}}),!1}}),c}]),c.otherwise(function(a,b){var c=a.get("$state");c.go("dashboard")})}]);var persian={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"},traverse=function(a){if(3==a.nodeType){var b=a.data.match(/[0-9]/g);if(null!=b&&0!=b.length)for(var c=0;c<b.length;c++)a.data=a.data.replace(b[c],persian[b[c]])}for(var c=0;c<a.childNodes.length;c++)traverse(a.childNodes[c])},fixPersianNumbers=function(){traverse(document.body)},fixFooter=function(){traverse(document.body)},activeElement=function(a,b){if(b){var c=$(b);c.addClass("active").siblings().removeClass("active")}var d=$(a);d.addClass("active").siblings().removeClass("active")},cmsVars={},hideCMS=function(a){a?(cmsVars.v1=$(".content-wrapper").css("marginRight"),cmsVars.v2=$(".main-footer").css("marginRight"),cmsVars.v3=$(".main-header").css("display"),cmsVars.v4=$(".main-sidebar").css("display"),$(".content-wrapper").css("margin-right","0"),$(".main-footer").css("margin-right","0"),$(".main-header").css("display","none"),$(".main-sidebar").css("display","none")):($(".content-wrapper").css("margin-right",cmsVars.v1),$(".main-footer").css("margin-right",cmsVars.v2),$(".main-header").css("display",cmsVars.v3),$(".main-sidebar").css("display",cmsVars.v4))};app.factory("Extention",["$http","$timeout","$rootScope","$state","$stateParams","toaster","$uibModal",function(a,b,c,d,e,f,g){c.logout=function(){h.post("logout").then(function(a){a&&"success"==a.Status?window.location="../":h.popError("مشکل ، لطفا دوباره امتحان کنید.")})},c.session=session,c.spinner={};var h={};return h.workers=0,h.serviceBase=serviceBaseURL,h.debugMode=debugMode,h.noImageClass="fa fa-2x fa-user",h.setBusy=function(a){a?(0===h.workers&&(c.spinner.active=!0),h.workers++):(h.workers--,0===h.workers&&b(h.disableLoading,500))},h.toast=function(a){f.pop(a.status,"",a.message,1e4,"trustedHtml")},h.pop=function(a,b,c){c||(c=7e3),f.pop(a,"",b,c,"trustedHtml")},h.popError=function(a,b){b||(b=7e3),f.pop("error","",a,b,"trustedHtml")},h.popSuccess=function(a,b){b||(b=7e3),f.pop("success","",a,b,"trustedHtml")},h.popInfo=function(a,b){b||(b=7e3),f.pop("info","",a,b,"trustedHtml")},h.get=function(b){return h.setBusy(!0),a.get(h.serviceBase+b).then(function(a){return h.setBusy(!1),a.data},function(a){return h.setBusy(!1),a})},h.getExternal=function(b){return h.setBusy(!0),a.get(b).then(function(a){return h.setBusy(!1),a.data},function(a){return h.setBusy(!1),a})},h.post=function(b,c){return h.setBusy(!0),a.post(h.serviceBase+b,c).then(function(a){return h.debugMode&&(console.log(a.data),200!=a.status&&h.popModal(a)),h.setBusy(!1),a.data.AuthState&&"UN_AUTH"==a.data.AuthState&&(console.log("State : UN_AUTHORIZED_USER"),window.location="../"),a.data},function(a){return h.debugMode&&(console.log(a.data),h.popModal(a.data)),a.data.AuthState&&"UN_AUTH"==a.data.AuthState&&(console.log("State : UN_AUTHORIZED_USER"),window.location="../"),h.setBusy(!1),a})},h.postAsync=function(b,c){return a.post(h.serviceBase+b,c).then(function(a){return h.debugMode&&200!=a.status&&h.popModal(a),a.data},function(a){return h.debugMode&&h.popModal(a.data),a})},h.disableLoading=function(){c.spinner.active=!1},h.authUser=function(a){c.authenticated=!0,c.user={},c.user.UserID=a.UserID,c.user.lastName=a.LastName,c.user.firstName=a.FirstName},h.unAuthUser=function(){c.authenticated=!1,c.isAdmin=!1,c.user={}},h.isAdmin=function(){return c.isAdmin},h.getAuth=function(){return{authenticated:c.authenticated,isAdmin:c.isAdmin}},h.openSignupPanel=function(a){var b;b="en"==a?"partials/HomeEN/SignupTemplate.html":"partials/Home/SignupTemplate.html",g.open({animation:!0,templateUrl:b,controller:"authCtrl",size:"md"})},h.openSigninPanel=function(a){var b;b="en"==a?"partials/HomeEN/LoginTemplate.html":"partials/Home/LoginTemplate.html",g.open({animation:!0,templateUrl:b,controller:"authCtrl",size:"md"})},h.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}var c=b(),d=a,e=d>c?d-c:c-d;if(e<100)return void scrollTo(0,d);var f=Math.round(e/10);f>=5&&(f=5);var g=Math.round(e/25),h=d>c?c+g:c-g,i=0;if(d>c)for(var j=c;j<d;j+=g)setTimeout("window.scrollTo(0, "+h+")",i*f),h+=g,h>d&&(h=d),i++;else for(var j=c;j>d;j-=g)setTimeout("window.scrollTo(0, "+h+")",i*f),h-=g,h<d&&(h=d),i++},h.scrollToElement=function(a,b){function c(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function d(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!=document.body;)d=d.offsetParent,c+=d.offsetTop;return c}b||(b=0);var e=c(),f=d(a)+b,g=f>e?f-e:e-f;if(g<100)return void scrollTo(0,f);var h=Math.round(g/10);h>=5&&(h=5);var i=Math.round(g/25),j=f>e?e+i:e-i,k=0;if(f>e)for(var l=e;l<f;l+=i)setTimeout("window.scrollTo(0, "+j+")",k*h),j+=i,j>f&&(j=f),k++;else for(var l=e;l>f;l-=i)setTimeout("window.scrollTo(0, "+j+")",k*h),j-=i,j<f&&(j=f),k++},h}]),app.factory("OnlineSocket",["$http","$timeout","$rootScope","Extention",function(a,b,c,d){var e={};return e.getData=function(){b(function(){e.fetch()},5e4)},e.fetch=function(){d.postAsync("getSocketData").then(function(a){c.socketData=a,b(function(){c.$broadcast("socketDataChanged")}),e.getData()})},e.fetch(),e}]),app.directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}),app.run(["$rootScope","$templateCache","$state","$location","Extention","OnlineSocket",function(a,b,c,d,e,f){a.spinner={},a.$on("$stateChangeSuccess",function(){e.setBusy(!1)}),a.$on("$stateChangeError",function(a,b,c,d,f,g){e.setBusy(!1)}),a.$on("$stateNotFound",function(a,b,c,d){e.setBusy(!1)}),a.$on("$stateChangeStart",function(b,c,d){e.setBusy(!0),a.globalSearchActive=!1})}]),app.filter("fileSizeFilter",function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["بایت","کیلوبایت","مگابایت","گیگابایت","ترابایت","پتابایت"],d=Math.floor(Math.log(a)/Math.log(1024));return persianJs((a/Math.pow(1024,Math.floor(d))).toFixed(b)).englishNumber().toString()+" "+c[d]}}),app.filter("fileSizeFilterEnglish",function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["B","KB","MB","GB","TB","PT"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}),app.filter("jalaliDate",function(){return function(a,b){var c=moment(a);return c.fromNow()+" "+c.format(b)}}),app.filter("jalaliDateSimple",function(){return function(a,b){var c=moment(a);return c.format(b)}}),app.filter("moment",function(){return function(a,b){return moment(a).format(b)}}),app.filter("subString",function(){return function(a,b){return a&&a.length>b?a.substr(0,b)+"...":a}}),app.filter("fromNow",function(){return function(a){var b=moment(a);return b.fromNow()}}),app.filter("split",function(){return function(a,b,c){if(!a)return"";for(var d="",e=0;e<a.length;e++)d+=e===a.length-1?a[e][c]:a[e][c]+b;return d}}),app.directive("slideable",function(){return{restrict:"C",compile:function(a,b){var c=a.html();return a.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+c+"</div>"),function(a,b,c){c.duration=c.duration?c.duration:"1s",c.easing=c.easing?c.easing:"ease-in-out",b.css({overflow:"hidden",height:"0px",transitionProperty:"height",transitionDuration:c.duration,transitionTimingFunction:c.easing})}}}}),app.directive("slideToggle",function(){return{restrict:"A",link:function(a,b,c){var d=document.querySelector(c.slideToggle);c.expanded=!1,b.bind("click",function(){var a=d.querySelector(".slideable_content");if(c.expanded)d.style.height="0px";else{a.style.border="1px solid rgba(0,0,0,0)";var b=a.clientHeight;a.style.border=0,d.style.height=b+"px"}c.expanded=!c.expanded})}}}),app.directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]),angular.module("ui.router.title",["ui.router"]).run(["$rootScope","$timeout","$state","Extention",function(a,b,c,d){function e(a){return angular.isFunction(a)?a():a}a.$on("$stateChangeSuccess",function(){var f=c.$current.locals.globals.$title,g=c.$current.locals.globals.$isAsyncTitle;if(g)d.post(f).then(function(d){b(function(){a.$title=d.SiteName}),a.$breadcrumbs=[];for(var f=c.$current;f;)f.resolve&&f.resolve.$title&&a.$breadcrumbs.unshift({title:e(f.locals.globals.$title),state:f.self.name,stateParams:f.locals.globals.$stateParams}),f=f.parent});else{var h=e(f);b(function(){a.$title=h}),a.$breadcrumbs=[];for(var i=c.$current;i;)i.resolve&&i.resolve.$title&&a.$breadcrumbs.unshift({title:e(i.locals.globals.$title),state:i.self.name,stateParams:i.locals.globals.$stateParams}),i=i.parent}})}]),angular.module(appName).controller("AllAdminsCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g){a.action="افزودن",a.pagingParams={},a.pagingController={},a.user={},a.adminType={selected:{}},a.forumType={selected:{}},a.adminTypes=[],a.forumTypes=[],a.Person={},a.selectedAdmin={},g.post("getAllAdminTypes",{}).then(function(b){b&&"success"==b.Status&&(a.adminTypes=b.Data)}),g.post("getAllForumTypes",{}).then(function(b){b&&"success"==b.Status&&(a.forumTypes=b.Data)}),a.search=function(){a.pagingController.update()},a.updateAdmin=function(){a.adminType.selected&&a.Person.selected&&("Administrator"==a.adminType.selected.Permission?a.selectedAdmin.ForumID=a.forumType.selected?a.forumType.selected.ID:null:a.selectedAdmin.ForumID=null,a.selectedAdmin.PermissionID=a.adminType.selected.ID,a.selectedAdmin.UserID=a.Person.selected.ID,console.log(a.selectedAdmin),g.post("updateAdmin",a.selectedAdmin).then(function(b){b&&"success"==b.Status&&(a.search(),"افزودن"==a.action?g.popSuccess("مدیر با موفقیت اضافه شد!"):"ویرایش"==a.action&&(g.popSuccess("مدیر با موفقیت ویرایش شد!"),a.action="افزودن"),a.pagingController.update())}))},a.deleteAdmin=function(b){g.post("deleteAdmin",{AdminID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("کاربر با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف کاربر ، لطفا دوباره امتحان کنید.")})},a.editAdmin=function(b){for(var c=0;c<a.adminTypes.length;c++)if(a.adminTypes[c].ID==b.PID){a.adminType.selected=a.adminTypes[c];break}if(a.forumType.selected=null,null!=b.ForumID)for(var c=0;c<a.forumTypes.length;c++)if(a.forumTypes[c].ID==b.ForumID){a.forumType.selected=a.forumTypes[c];break}a.Person.selected={ID:b.UserID,FullName:b.FullName},a.action="ویرایش"},a.getPersons=function(b){g.postAsync("getUsersByName",{filter:b}).then(function(b){b&&"success"==b.Status?a.users=b.Data:g.popError("مشکل در اتصال.")})},activeElement("#SAdmins")}]),angular.module(appName).controller("AdminCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$log",function(a,b,c,d,e,f,g){}]),angular.module(appName).controller("AdminPostCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g){a.pagingParams={},a.pagingController={},a.Posts=[],a.removePost=function(b){g.post("deletePost",{PostID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("مطلب با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف مطلب ، لطفا دوباره امتحان کنید.")})},a.getTagColor=function(a){switch(a=a%5+1){case 1:return"label-success";case 2:return"label-warning";case 4:return"label-primary";case 5:return"label-danger";default:return"label-success"}},activeElement("#SAdminPost")}]),angular.module(appName).controller("AnswersCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention","$stateParams","$uibModal",function(a,b,c,d,e,f,g,h,i){a.adminType=h.id,a.pagingParams={SubjectName:h.id,answerType:null},a.pagingController={},a.dropDwonTitle="نمایش جواب ها",a.Position={},g.postAsync("getAllPositions",{}).then(function(b){a.allPositions=b}),a.search=function(){a.pagingController.update()},a.changeAnswerState=function(b,c){g.post("changeAnswerAccepted",{State:c,AnswerID:b.ID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:b.AuthorID,AuthorID:b.QuestionAuthorID,QuestionID:b.QuestionID}).then(function(b){b&&"success"==b.Status?(g.popSuccess("وضعیت جواب با موفقیت تغییر کرد!"),a.pagingController.update()):g.popError("مشکل در تغییر وضعیت جواب ، لطفا دوباره تلاش کنید.")})},a.removeAnswer=function(b,c){g.post("deleteAnswer",{AnswerID:b,AdminPermissionLevel:session.AdminPermissionLevel,UserID:c}).then(function(b){b&&"success"==b.Status?(g.popSuccess("جواب با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف جواب ، لطفا دوباره امتحان کنید.")})},a.changeTypeFilter=function(b){switch(a.pagingParams.answerType=b,b){case null:a.dropDwonTitle="همه ی جواب ها";break;case 1:a.dropDwonTitle="جواب ها تایید شده";break;case 0:a.dropDwonTitle="جواب ها در انتظار تایید";break;case-1:a.dropDwonTitle="جواب ها تایید نشده";break;default:a.dropDwonTitle="نمایش جواب ها"}a.search()},a.openDiscardModal=function(b,c){g.post("getCommonMessages",{filter:"رد جواب"}).then(function(d){if(d&&"success"==d.Status){var e=i.open({animation:!0,templateUrl:"DiscardAnswerModal.html",controller:["$scope","$uibModalInstance",function(a,e){a.common=d.Data,a.answerID=b,a.authorID=c,a.cancel=function(){e.dismiss("cancel")},a.send=function(b){g.post("changeAnswerAccepted",{State:-1,AnswerID:a.answerID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:a.authorID,Message:b}).then(function(a){a&&"success"==a.Status?(g.popSuccess("وضعیت جواب با موفقیت تغییر کرد!"),e.dismiss("cancel")):g.popError("مشکل در تغییر وضعیت جواب ، لطفا دوباره تلاش کنید.")})}}],size:"md"});e.result.then(function(){},function(){a.pagingController.update()})}})},a.openRoleModal=function(b,c){var d=i.open({animation:!0,templateUrl:"myModalContent.html",controller:["$scope","$uibModalInstance",function(a,d){a.adminType=c,a.editMode=!1,a.Answer=b,a.AnswerText=a.Answer.AnswerText,a.QuestionText=a.Answer.QuestionText,a.cancel=function(){d.dismiss("cancel")},a.changeEditMode=function(){a.editMode=!a.editMode},a.editAnswer=function(){a.AnswerText&&g.post("editAnswer",{AnswerID:a.Answer.ID,AnswerText:a.AnswerText}).then(function(b){b&&"success"==b.Status?(g.popSuccess("جواب با موفقیت ویرایش شد!"),a.editMode=!1):g.popError("مشکل در ویرایش جواب ، لطفا دوباره امتحان کنید.")})}}],size:"md"});d.result.then(function(){},function(){a.pagingController.update()})},a.changePosition=function(){a.pagingParams.OrganizationID=a.Position.selected?a.Position.selected.ID:null,a.search()},activeElement("#SAnswers","#S"+h.id)}]),angular.module(appName).controller("AwardQuestionCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f,g){a.question={},a.allTags=[],a.allSubjects=[],a.errForum={},a.errForum.title=!1,a.errForum.text=!1,a.form={},a.att={},c.id?(a.question.ID=c.id,a.form.header="ویرایش سوال",a.form.submitButton="ویرایش سوال",f.post("getQuestionMetaEdit",{QuestionID:a.question.ID}).then(function(b){a.allTags=b.AllTags,a.allSubjects=b.AllSubjects,a.question=b.Question,a.QuestionTextIN=b.Question.QuestionText,e(function(){for(var c=a.question.MainSubject,d=0;d<b.AllSubjects.length;d++)if(c.SubjectID==b.AllSubjects[d].SubjectID){a.question.MainSubject=b.AllSubjects[d];break}a.allChildSubjects=a.question.MainSubject.Childs})}),e(function(){b.$title="ویرایش سوال"})):(a.form.header="ایجاد سوال جدید",a.form.submitButton="ارسال سوال",f.post("getQuestionMetaEdit").then(function(b){a.allTags=b.AllTags,a.allSubjects=b.AllSubjects})),a.saveQuestion=function(){var b=!1;if(a.question.Title||(a.errForum.title=!0,b=!0),a.QuestionTextIN||(a.errForum.text=!0,b=!0),a.question.QuestionText=a.QuestionTextIN,a.question.MainSubject||(a.errForum.mainSubject=!0,b=!0),a.question.Subject||(a.errForum.subject=!0,b=!0),b)return void f.popError("لطفا فرم سوال را به طور کامل پر کنید!");if(a.question.ID)f.post("editQuestion",a.question).then(function(a){a?"success"==a.Status?f.popSuccess("سوال با موفقیت تغییر کرد."):"CanNotEdit"==a.Status?f.popError("<b>خطا در تغییر محتوای سوال!<b><br> تغییرات فقط تا زمانی که سوال در انتظار تایید است مقدور میباشد. ",12e3):"Deleted"==a.Status?f.popError("خطا ، این سوال وجود ندارد.",12e3):f.popError("خطا در ارتباط با سرور ، لطفا دوباره تلاش کنید."):f.popError("خطا در ارتباط با سرور ، لطفا دوباره تلاش کنید.")});else{f.setBusy(!0);var c=g.upload({url:serviceBaseURL+"saveAwardQuestion",method:"POST",file:a.att.myFiles,data:{formData:angular.toJson(a.question)}});c.then(function(b){f.setBusy(!1),f.popSuccess("سوال شما با موفقیت ارسال شد!"),a.emptyForm()},function(a){f.setBusy(!1),f.popError("مشکل در ثبت سوال سوال ، لطفا دوباره تلاش کنید!")})}},a.emptyForm=function(){a.question={},a.att.myFiles=[],a.QuestionTextIN=void 0},a.fieldChanged=function(b,c){a.errForum[b]=void 0==c||""==c,a.QuestionTextIN=a.QuestionTextIN.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},a.subjectChanged=function(){a.errForum.mainSubject=!1,a.allChildSubjects=a.question.Subject=void 0,e(function(){a.allChildSubjects=a.question.MainSubject.Childs})},a.childSubjectChanged=function(){a.errForum.subject=!1},a.filesChanged=function(b,c,d,e,f,g){a.att.myFiles},a.removeFile=function(b){var c=a.att.myFiles.indexOf(b);a.att.myFiles.splice(c,1)},activeElement("#SAwardQuestion","#SAddAwardQuestion")}]),angular.module(appName).controller("AwardQuestionsCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention","$stateParams","$uibModal",function(a,b,c,d,e,f,g,h,i){a.pagingParams={},a.pagingController={},a.search=function(){a.pagingController.update()},a.changeQuestionState=function(b,c){g.post("changeQuestionAccepted",{State:c,QuestionID:b.ID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:b.AuthorID,QuestionSubjectID:b.SubjectID}).then(function(b){b&&"success"==b.Status?(g.popSuccess("وضعیت سوال با موفقیت تغییر کرد!"),a.pagingController.update()):g.popError("مشکل در تغییر وضعیت سوال ، لطفا دوباره تلاش کنید.")})},a.removeQuestion=function(b,c){g.post("deleteQuestion",{QuestionID:b,AdminPermissionLevel:session.AdminPermissionLevel,UserID:c}).then(function(b){b&&"success"==b.Status?(g.popSuccess("سوال با موفقیت حذف شد!"),a.pagingController.update()):(console.log(b),g.popError("مشکل در حذف سوال ، لطفا دوباره امتحان کنید."))})},a.openRoleModal=function(b){var c=i.open({animation:!0,templateUrl:"myModalContent.html",controller:["$scope","$uibModalInstance",function(a,c){a.Question=b,a.QuestionText=a.Question.QuestionText,a.Title=a.Question.Title,a.cancel=function(){c.dismiss("cancel")},a.editQuestion=function(){a.Title&&a.QuestionText&&g.post("editQuestion",{QuestionID:a.Question.ID,QuestionText:a.QuestionText,Title:a.Title}).then(function(b){b&&"success"==b.Status?(g.popSuccess("سوال با موفقیت ویرایش شد!"),a.editMode=!1):g.popError("مشکل در ویرایش سوال ، لطفا دوباره امتحان کنید.")})}}],size:"md"});c.result.then(function(){},function(){a.pagingController.update()})},a.openDiscardModal=function(b,c){g.post("getCommonMessages",{filter:"رد سوال"}).then(function(d){if(d&&"success"==d.Status){var e=i.open({animation:!0,templateUrl:"DiscardQuestionModal.html",controller:["$scope","$uibModalInstance",function(a,e){a.common=d.Data,a.questionID=b,a.authorID=c,a.cancel=function(){e.dismiss("cancel")},a.send=function(b){g.post("changeQuestionAccepted",{State:-1,QuestionID:a.questionID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:a.authorID,Message:b}).then(function(a){a&&"success"==a.Status?(g.popSuccess("وضعیت سوال با موفقیت تغییر کرد!"),e.dismiss("cancel")):g.popError("مشکل در تغییر وضعیت سوال ، لطفا دوباره تلاش کنید.")})}}],size:"md"});e.result.then(function(){},function(){a.pagingController.update()})}})},activeElement("#SQuestions","#SS"+h.id),fixFooter()}]),angular.module(appName).controller("DashboardCtrl",["$scope","ADMdtpConvertor","$rootScope","Extention","$state","$timeout",function(a,b,c,d,e,f){a.newQuestionsDigram={},a.provinceDigram={},a.incrementChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"IQuestionCount",fillColors:"#00BBCC",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"IAnswerCount",fillColors:"#e74c3c",fillAlphas:.2,bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],a.dailyChartOptions=[{id:"g1",type:"smoothedLine",lineColor:"#00BBCC",valueField:"QuestionCount",fillColors:"#00BBCC",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,classNameField:"classNameQ",balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' سوال <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}},{id:"g2",type:"smoothedLine",lineColor:"#e74c3c",valueField:"AnswerCount",fillColors:"#e74c3c",bullet:"round",bulletColor:"#FFFFFF",bulletBorderAlpha:1,bulletBorderThickness:2,bulletSize:7,useLineColorForBulletBorder:!0,lineThickness:2,classNameField:"classNameA",balloon:{drop:!1},balloonFunction:function(a,b){var c=a.values.value,d=moment(a.category),e=d.format("jYYYY/jMM/jDD");return'<b style="font-size: 13px">'+persianJs(c+' جواب <br><span class="text-muted">'+e+"</span>").englishNumber().toString()+"</b>"}}],a.radarChartGraphs=[{valueField:"QTotal",bullet:"round",balloonFunction:function(a,b){var c=a.values.value;return'<span style="font-size: 13px">'+persianJs(" سوال"+c).englishNumber().toString()+"</span>"}},{valueField:"ATotal",bullet:"round",balloonFunction:function(a,b){var c=a.values.value;return'<span style="font-size: 13px">'+persianJs(" جواب"+c).englishNumber().toString()+"</span>"}}],a.stackChartOptions=[{fillAlphas:.8,lineAlpha:.2,type:"column",valueField:"QTotal",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs(a.values.value.toString()).englishNumber().toString()},balloonFunction:function(a){return'<b style="font-size: 15px">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs(a.values.value.toString()).englishNumber().toString()+"</span><span style='font-size=15px'>سوال</span>"}},{fillAlphas:.8,lineAlpha:.2,type:"column",valueField:"ATotal",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs((-a.values.value).toString()).englishNumber().toString()},balloonFunction:function(a){return'<b style="font-size: 15px;">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs((-a.values.value).toString()).englishNumber().toString()+"</span><span style='font-size=15px'>جواب</span>"}},{fillAlphas:1,lineAlpha:0,type:"column",valueField:"ATotalNA",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs((-a.values.value).toString()).englishNumber().toString()},balloonFunction:function(a){var b='<b style="font-size: 15px">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs((-a.values.value).toString()).englishNumber().toString()+"</span><span style='font-size=15px'>جواب تایید نشده</span>";return b}},{fillAlphas:1,lineAlpha:0,type:"column",valueField:"QTotalNA",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs(a.values.value.toString()).englishNumber().toString()},balloonFunction:function(a){return'<b style="font-size: 15px">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs(a.values.value.toString()).englishNumber().toString()+"</span><span style='font-size=15px'>سوال تایید نشده</span>";
}}];var g=function(a){if("jalali"==a.calType){var c=b.toGregorian(a.year,a.month,a.day);return c.year+"-"+h(c.month)+"-"+h(c.day)+" "+h(a.hour)+":"+h(a.minute)}return a.year+"-"+h(a.month)+"-"+h(a.day)+" "+h(a.hour)+":"+h(a.minute)},h=function(a){return a<10?"0"+a:a};a.updateNewQuestionDiagram=function(){f(function(){var b={};angular.isDefined(a.newQuestionsDigram.MainSubject)&&(b.MainSubjectID=a.newQuestionsDigram.MainSubject.ID),angular.isDefined(a.newQuestionsDigram.Organization)&&(b.OrganizationID=a.newQuestionsDigram.Organization.ID),angular.isDefined(a.newQuestionsDigram.to)&&""!=a.newQuestionsDigram.to&&(b.toDate=g(a.newQuestionsDigram.toFull)),angular.isDefined(a.newQuestionsDigram.from)&&""!=a.newQuestionsDigram.from&&(b.fromDate=g(a.newQuestionsDigram.fromFull)),d.post("getNewQuestionsGraphData",b).then(function(b){a.dashboardData.ChartData=b})})},d.post("getDashboardData").then(function(b){b.MainSubjects.splice(0,0,{ID:-1,Title:"همه انجمن ها"}),b.Organs.splice(0,0,{ID:-1,OrganizationName:"همه ناحیه ها"}),a.dashboardData=b}),activeElement("#SDashboard")}]),angular.module(appName).controller("ManageLibraryCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention","$uibModal",function(a,b,c,d,e,f,g,h){a.pagingParams={},a.pagingController={},a.search=function(){a.pagingController.update()},a.removeFile=function(b){g.post("deleteFile",{ID:b.ID,FileID:b.FileID,AbsolutePath:b.AbsolutePath}).then(function(b){console.log(b),b&&"success"==b.Status?(g.popSuccess("فایل با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف فایل ، لطفا دوباره امتحان کنید.")})},a.changeFileState=function(b,c){g.post("changeLibraryFileAccepted",{State:c,LibraryID:b.ID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:b.UserID}).then(function(b){b&&"success"==b.Status?(g.popSuccess("وضعیت فایل با موفقیت تغییر کرد!"),a.pagingController.update()):g.popError("مشکل در تغییر وضعیت فایل ، لطفا دوباره تلاش کنید.")})},a.openDiscardModal=function(b,c){g.post("getCommonMessages",{filter:"رد فایل"}).then(function(d){if(d&&"success"==d.Status){var e=h.open({animation:!0,templateUrl:"DiscardAnswerModal.html",controller:["$scope","$uibModalInstance",function(a,e){a.common=d.Data,a.LibraryID=b,a.UserID=c,a.cancel=function(){e.dismiss("cancel")},a.send=function(b){g.post("changeLibraryFileAccepted",{State:-1,LibraryID:a.LibraryID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:a.UserID,Message:b}).then(function(a){a&&"success"==a.Status?(g.popSuccess("وضعیت فایل با موفقیت تغییر کرد!"),e.dismiss("done")):(console.log(a),g.popError("مشکل در تغییر وضعیت فایل ، لطفا دوباره تلاش کنید."))})}}],size:"md"});e.result.then(function(b){"done"==b&&a.pagingController.update()},function(b){"done"==b&&a.pagingController.update()})}})},a.openRoleModal=function(a){console.log(a);h.open({animation:!0,templateUrl:"myModalContent.html",controller:["$scope","$uibModalInstance",function(b,c){b.File=a,b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},activeElement("#SLibrary","#SFilaeManage")}]),angular.module(appName).controller("UploadLibraryCtrl",["$scope","$rootScope","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f){a.allTags=[],e.post("getAllTags").then(function(b){a.allTags=b.Items}),a.isResumeSupported=f.isResumeSupported(),e.post("getUploadLibraryData").then(function(b){a.pageData=b}),a.subjectChanged=function(a){a.allChildSubjects=void 0,a.Subject=void 0,d(function(){a.allChildSubjects=a.MainSubject.Childs})},a.togglePauseUploadFile=function(a){a.uploader.pause()},a.removeFile=function(b){if(0==b.uploadState)b.uploader.abort(),b.percent="0";else{var c=a.myFiles.indexOf(b);a.myFiles.splice(c,1)}},a.startUploadAll=function(){if(a.myFiles&&a.myFiles.length){for(var b=0,c=0;c<a.myFiles.length;c++){var d=a.myFiles[c];1!=d.uploadState?a.startUploadFile(d):b++}b==a.myFiles.length&&e.popInfo("تمامی فایل ها آپلود شده اند!")}else e.popInfo("هیچ فایلی برای آپلود انتخاب نشده!")},a.startUploadFile=function(b){if(0!=b.uploadState){b.uploadState=0;var c=void 0,d=void 0;angular.isDefined(b.MainSubject)&&(d=b.MainSubject.SubjectID),angular.isDefined(b.Subject)&&(c=b.Subject.ID),console.log({file:b,Description:b.Description,SubjectID:c,MainSubjectID:d,Title:b.Title,Tags:b.Tags}),b.uploader=f.upload({url:uploadURL+"upload_library.php",data:{file:b,Description:b.Description,SubjectID:c,MainSubjectID:d,Title:b.Title,Tags:b.Tags}}),b.uploader.then(function(a){a.config.data.file.uploadState=1,console.log("Success "+a.config.data.file.name+"uploaded. Response: "+a.data)},function(a){a.config.data.file.uploadState=2,a.status==-1&&(a.config.data.file.percent=0),console.log("Error status: "+a.status)},function(b){var c=parseInt(100*b.loaded/b.total);b.config.data.file.percent=c,b.config.data.file.loaded=a.sizeFilter(b.loaded)})}};var g=["B","KB","MB","GB","TB","PT"];a.sizeFilter=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return persianJs((a/Math.pow(1024,Math.floor(b))).toFixed(1)).englishNumber().toString()+" "+g[b]},a.abortUpload=function(a){a.uploader.abort()},a.isImageFormat=function(a){var b=a.indexOf("image");return b>-1},activeElement("#SLibrary","#SUpload")}]),angular.module(appName).controller("MessageCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$stateParams","$uibModal","Extention",function(a,b,c,d,e,f,g,h,i){a.showInbux=!0,a.showSendMessage=!1,a.showReciveMessage=!1,g.id==b.session.UserID&&(a.pagingParams={UserID:g.id,MessageType:null,searchValue:""}),a.dropDwonTitle="نمایش پیام ها",a.user={},a.pagingController={},a.messagesPagingController={},a.user.selectedUser=[],a.users=[],a.Message={},a.Messages=[],a.all={},a.checkAll=function(){if(a.all.checked)for(var b=0;b<a.Messages.length;b++)a.Messages[b].checked=!0},a.clearMiniSpace=function(){a.Message.MessageIn=a.Message.MessageIn.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},a.getPersons=function(b){console.log(b),i.postAsync("getUsersByName",{filter:b}).then(function(b){b&&"success"==b.Status?a.users=b.Data:i.popError("مشکل در اتصال.")})},a.sentMessage=function(b){0!=a.user.selectedUser.length&&a.Message.MessageIn&&a.Message.MessageTitle&&(1==b?a.Message.MessageType=1:a.Message.MessageType=0,a.Message.Message=a.Message.MessageIn.replace(/\r\n|\r|\n/g,"<br />"),i.post("sendMessage",{Message:a.Message,Users:a.user.selectedUser}).then(function(b){b&&"success"==b.Status?(a.user.selectedUser=[],i.popSuccess("پیام های شما ارسال شد")):i.popError("مشکل در اتصال.")},function(a){console.log(a)}))},a.deleteMessage=function(b){i.post("deleteMessage",{MessageID:b.ID}).then(function(b){b&&"success"==b.Status?(i.popSuccess("پیام با موفقیت حذف شد!"),a.messagesPagingController.update()):i.popError("مشکل در حذف پیام ، لطفا دوباره امتحان کنید.")})},a.deleteMessages=function(){for(var b=!0,c="",d=0;d<a.Messages.length;d++)b&&a.Messages[d].checked?(b=!1,c="("+a.Messages[d].ID):!b&&a.Messages[d].checked&&(c+=","+a.Messages[d].ID);b||(c+=")"),c&&i.post("deleteMessages",{MessagesID:c}).then(function(b){b&&"success"==b.Status?(i.popSuccess("پیام با موفقیت حذف شد!"),a.messagesPagingController.update()):(console.log(b),i.popError("مشکل در حذف پیام ، لطفا دوباره امتحان کنید."))})},a.changeTypeFilter=function(b){switch(a.pagingParams.MessageType=b,b){case null:a.dropDwonTitle="همه ی پیام ها";break;case 1:a.dropDwonTitle="پیام های ایمیلی";break;case 0:a.dropDwonTitle="پیام های مستقیم";break;default:a.dropDwonTitle="نمایش پیام ها"}a.search()},a.openMessageModal=function(a){h.open({animation:!0,templateUrl:"Message1Modal.html",controller:["$scope","$uibModalInstance",function(b,c){b.message=a,console.log(b.message),b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},a.showMessage=function(b){0==b.MessageViewed&&i.postAsync("markAsReadMessage",{MessageID:b.ID}).then(function(b){for(var c=0;c<a.message.all.length;c++)if(a.message.all[c].ID==b.Data){a.message.all[c].MessageViewed=1;break}for(var d=a.$parent.messages.All,c=0;c<d.length;c++)if(d[c].ID==b.Data){d.splice(c,1);var d=a.$parent.messages.Total-=1;break}}),h.open({animation:!0,templateUrl:"MessageModal.html",controller:["$scope","$uibModalInstance","Message",function(a,c,e){a.message=e,a.getAdmin=function(){d.go("UserProfile",{id:b.SenderUserID}),c.dismiss("cancel")},a.cancel=function(){c.dismiss("cancel")}}],size:"md",resolve:{Message:function(){return b}}})},a.search=function(){a.messagesPagingController.update()},activeElement("#SContact")}]),angular.module(appName).controller("CommonMessageCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g){a.pagingParams={},a.pagingController={},a.Messages=[],a.messageType="رد سوال",a.messageName="",a.removeMessage=function(b){g.post("deleteMessage",{MessageID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("پیام با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف پیام ، لطفا دوباره امتحان کنید.")})},a.insertMessage=function(){a.messageType&&a.messageName&&a.messageName.length>0&&g.post("insertMessage",{MessageType:a.messageType,MessageName:a.messageName}).then(function(b){b&&"success"==b.Status?(a.messageType="رد سوال",a.messageName="",g.popSuccess("پیام اضافه شد"),a.pagingController.update()):(console.log(b),g.popError("مشکل در وارد کردن پیام ، لطفا دوباره تلاش کنید."))})},activeElement("#SMeta","#SCommonMessages")}]),angular.module(appName).controller("EducationCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g){a.pagingParams={},a.pagingController={},a.search=function(){a.pagingController.update()},a.insertEducation=function(){a.educationName&&g.post("insertEducation",{Name:a.educationName}).then(function(b){b&&"success"==b.Status?(g.popSuccess("مدرک اضافه شد"),a.pagingController.update()):g.popError("مشکل در وارد کردن مدرک ، لطفا دوباره تلاش کنید.")})},a.removeEducation=function(b){g.post("deleteEducation",{ID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("مدرک با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف مدرک ، لطفا دوباره امتحان کنید.")})},activeElement("#SMeta","#SEducation"),fixFooter()}]),angular.module(appName).controller("SkillCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g){a.pagingParams={},a.pagingController={},a.search=function(){a.pagingController.update()},a.insertSkill=function(){a.skillName&&g.post("insertSkill",{Skill:a.skillName}).then(function(b){b&&"success"==b.Status?(a.skillName="",g.popSuccess("مهارت اضافه شد"),a.pagingController.update()):g.popError("مشکل در وارد کردن مهارت ، لطفا دوباره تلاش کنید.")})},a.removeSkill=function(b){g.post("deleteSkill",{ID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("مهارت با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف مهارت ، لطفا دوباره امتحان کنید.")})},activeElement("#SMeta","#SSkill")}]),angular.module(appName).controller("TagCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention",function(a,b,c,d,e,f,g){a.pagingParams={},a.pagingController={},a.search=function(){a.pagingController.update()},a.insertTag=function(){a.tagName&&g.post("insertTag",{Text:a.tagName}).then(function(b){b&&"success"==b.Status?(g.popSuccess("تگ اضافه شد"),a.pagingController.update()):g.popError("مشکل در وارد کردن تگ ، لطفا دوباره تلاش کنید.")})},a.removeTag=function(b){g.post("deleteTag",{ID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("تگ با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف تگ ، لطفا دوباره امتحان کنید.")})},activeElement("#SMeta","#STag")}]),angular.module(appName).controller("NewAdminPostCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f,g){a.adminPost={},a.allTags=[],a.allSubjects=[],a.errForum={},a.errForum.title=!1,a.errForum.text=!1,a.form={},a.att={},c.id?(a.adminPost.ID=c.id,a.form.header="ویرایش مطلب ادمین",a.form.submitButton="ویرایش مطلب ادمین",f.post("getAdminPostMetaEdit",{AdminPostID:a.adminPost.ID}).then(function(b){a.allSubjects=b.AllSubjects,a.allPostTypes=b.AllPostTypes,a.adminPost=b.AdminPost,a.AdminPostTextIN=b.AdminPost.PostText,e(function(){for(var c=a.adminPost.MainSubject,d=0;d<b.AllSubjects.length;d++)if(c.SubjectID==b.AllSubjects[d].SubjectID){a.adminPost.MainSubject=b.AllSubjects[d];break}a.allChildSubjects=a.adminPost.MainSubject.Childs;for(var e=a.adminPost.PostType,d=0;d<b.AllPostTypes.length;d++)if(e.ID==b.AllPostTypes[d].ID){a.adminPost.PostType=b.AllPostTypes[d];break}})}),e(function(){b.$title="ویرایش مطلب ادمین"})):(a.form.header="ایجاد مطلب جدید",a.form.submitButton="ارسال مطلب",f.post("getAdminPostMetaEdit").then(function(b){a.allSubjects=b.AllSubjects,a.allPostTypes=b.AllPostTypes})),a.saveAdminPost=function(){var b=!1;if(a.adminPost.Title||(a.errForum.title=!0,b=!0),a.adminPost.PostText||(a.errForum.text=!0,b=!0),a.adminPost.MainSubject||(a.errForum.mainSubject=!0,b=!0),a.adminPost.Subject||(a.errForum.subject=!0,b=!0),a.adminPost.PostType||(a.errForum.postType=!0,b=!0),b)return void f.popError("لطفا فرم را به طور کامل پر کنید!");if(a.adminPost.ID)f.post("editAdminPost",a.adminPost).then(function(a){a&&"success"==a.Status?f.popSuccess("مطلب با موفقیت تغییر کرد."):f.popError("خطا در ارتباط با سرور ، لطفا دوباره تلاش کنید.")});else{f.setBusy(!0);var c=g.upload({url:serviceBaseURL+"saveAdminPost",method:"POST",file:a.att.myFiles,data:{formData:angular.toJson(a.adminPost)}});c.then(function(b){f.setBusy(!1),f.popSuccess("مطلب شما با موفقیت ارسال شد!"),a.emptyForm()},function(a){f.setBusy(!1),f.popError("مشکل در ثبت مطلب ، لطفا دوباره تلاش کنید!")})}},a.emptyForm=function(){a.adminPost={},a.att.myFiles=[],a.AdminPostTextIN=void 0},a.fieldChanged=function(b,c){a.errForum[b]=void 0==c||""==c,a.adminPost.PostText=a.adminPost.PostText.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},a.subjectChanged=function(){a.errForum.mainSubject=!1,a.allChildSubjects=a.adminPost.Subject=void 0,e(function(){a.allChildSubjects=a.adminPost.MainSubject.Childs})},a.childSubjectChanged=function(){a.errForum.subject=!1},a.filesChanged=function(b,c,d,e,f,g){a.att.myFiles},a.removeFile=function(b){var c=a.att.myFiles.indexOf(b);a.att.myFiles.splice(c,1)},activeElement("#SAdminPost","#SNewAdminPost")}]),angular.module(appName).controller("NewPopUpCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f,g){a.mindate=Date.now(),a.popUp={},a.editMode=!1,a.savePopUp=function(){return a.popUp.toFull.unix?a.popUp.Title?a.popUp.ModalText?(a.popUp.ExpireDate=new Date(a.popUp.toFull.unix),void f.post("saveNewPopUp",a.popUp).then(function(a){a&&"success"==a.Status?f.popSuccess("پاپ آپ با موفقیت اضافه شد!"):f.popError("مشکل در حذف جواب ، لطفا دوباره امتحان کنید.")})):void f.popError("متن پاپ آپ را انتخاب کنید"):void f.popError("موضوع پاپ آپ را انتخاب کنید"):void f.popError("تاریخ اتمام پاپ آپ را انتخاب کنید")},a.fieldChanged=function(b,c){a.popUp.ModalText=a.popUp.ModalText.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},activeElement("#SPopUp","#SNewPopUp")}]),angular.module(appName).controller("PopUpManagerCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$stateParams","$uibModal","Extention",function(a,b,c,d,e,f,g,h,i){a.pagingController={},a.deletePopUp=function(b){i.post("deletePopUp",{PopUpID:b.ID}).then(function(b){b&&"success"==b.Status?(i.popSuccess("پیام با موفقیت حذف شد!"),a.pagingController.update()):i.popError("مشکل در حذف پیام ، لطفا دوباره امتحان کنید.")})},a.openPopUpModal=function(a){h.open({animation:!0,templateUrl:"popUp.html",controller:["$scope","$uibModalInstance",function(b,c){b.popup=a,b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},a.openPopUpUpdate=function(a){h.open({animation:!0,templateUrl:"popUpUpdate.html",controller:["$scope","$uibModalInstance",function(b,c){b.mindate=Date.now(),b.ExpireDate=new Date(Date.parse(a.ExpireDate.replace("-","/","g"))).getTime(),console.log(b.mindate),b.popup=a,b.cancel=function(){c.dismiss("cancel")},b.upgrade=function(){if(!b.toFull.unix)return void i.popError("تاریخ اتمام پاپ آپ را انتخاب کنید");var a=new Date(b.toFull.unix);i.post("updatePopUp",{ExpireDate:a,PopUpID:b.popup.ID}).then(function(a){a&&"success"==a.Status?(i.popSuccess("پاپ آپ با موفقیت تمدید شد!"),b.cancel()):i.popError("مشکل در تمدید پاپ آپ ، لطفا دوباره امتحان کنید.")})}}],size:"md"})},activeElement("#SPopUp","#SPopUps")}]),angular.module(appName).controller("QuestionsCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention","$stateParams","$uibModal",function(a,b,c,d,e,f,g,h,i){a.adminType=h.id,a.pagingParams={SubjectName:h.id,questionType:null},a.pagingController={},a.dropDwonTitle="نمایش سوال ها",a.Position={},g.postAsync("getAllPositions",{}).then(function(b){a.allPositions=b}),a.search=function(){a.pagingController.update()},a.changeQuestionState=function(b,c){g.post("changeQuestionAccepted",{State:c,QuestionID:b.ID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:b.AuthorID,QuestionSubjectID:b.SubjectID}).then(function(b){b&&"success"==b.Status?(g.popSuccess("وضعیت سوال با موفقیت تغییر کرد!"),a.pagingController.update()):g.popError("مشکل در تغییر وضعیت سوال ، لطفا دوباره تلاش کنید.")})},a.removeQuestion=function(b,c){g.post("deleteQuestion",{QuestionID:b,AdminPermissionLevel:session.AdminPermissionLevel,UserID:c}).then(function(b){b&&"success"==b.Status?(g.popSuccess("سوال با موفقیت حذف شد!"),a.pagingController.update()):(console.log(b),g.popError("مشکل در حذف سوال ، لطفا دوباره امتحان کنید."))})},a.changeTypeFilter=function(b){switch(a.pagingParams.questionType=b,b){case null:a.dropDwonTitle="همه ی سوال ها";break;case 1:a.dropDwonTitle="سوال ها تایید شده";break;case 0:a.dropDwonTitle="سوال ها در انتظار تایید";break;case-1:a.dropDwonTitle="سوال ها تایید نشده";break;default:a.dropDwonTitle="نمایش سوال ها"}a.search()},a.openRoleModal=function(b,c){var d=i.open({animation:!0,templateUrl:"myModalContent.html",controller:["$scope","$uibModalInstance",function(a,d){a.adminType=c,a.Question=b,a.QuestionText=a.Question.QuestionText,a.Title=a.Question.Title,a.editMode=!1,a.cancel=function(){d.dismiss("cancel")},a.changeEditMode=function(){a.editMode=!a.editMode},a.editQuestion=function(){a.Title&&a.QuestionText&&g.post("editQuestion",{QuestionID:a.Question.ID,QuestionText:a.QuestionText,Title:a.Title}).then(function(b){b&&"success"==b.Status?(g.popSuccess("سوال با موفقیت ویرایش شد!"),a.editMode=!1):g.popError("مشکل در ویرایش سوال ، لطفا دوباره امتحان کنید.")})}}],size:"md"});d.result.then(function(){},function(){a.pagingController.update()})},a.openQuestionModal=function(b){var c=i.open({animation:!0,templateUrl:"QuestionModal.html",controller:["$scope","$uibModalInstance",function(a,c){a.question=b,a.questionsPagingParams={SubjectName:h.id,questionType:1},a.questionsQagingController={},a.cancel=function(){c.dismiss("cancel")},a.search=function(){a.questionsQagingController.update()},a.Link=function(b){g.post("linkQuestion",{TargetQuestionID:b.ID,LinkedQuestionID:a.question.ID,UserID:a.question.AuthorID}).then(function(a){console.log(a),a&&"success"==a.Status?(g.popSuccess("سوال با موفقیت لینک داده شد!"),c.dismiss("cancel")):g.popError("مشکل در لینک دادن سوال ، لطفا دوباره امتحان کنید.")})}}],size:"lg"});c.result.then(function(){},function(){a.pagingController.update()})},a.openExchangeModal=function(b){g.post("getSubjects",{}).then(function(c){if(c&&"success"==c.Status){var d=i.open({animation:!0,templateUrl:"ExchangeModal.html",controller:["$scope","$uibModalInstance",function(a,d){a.subjects=c.Data,a.question=b,a.cancel=function(){d.dismiss("cancel")},a.send=function(b){g.post("exchangeQuestion",{SubjectID:b.ID,QuestionID:a.question.ID}).then(function(a){a&&"success"==a.Status?(g.popSuccess("سوال با موفقیت انتقال داده شد!"),d.dismiss("cancel")):g.popError("مشکل در انتقال سوال ، لطفا دوباره امتحان کنید.")})}}],size:"md"});d.result.then(function(){},function(){a.pagingController.update()})}})},a.openDiscardModal=function(b,c){g.post("getCommonMessages",{filter:"رد سوال"}).then(function(d){if(d&&"success"==d.Status){var e=i.open({animation:!0,templateUrl:"DiscardQuestionModal.html",controller:["$scope","$uibModalInstance",function(a,e){a.common=d.Data,a.questionID=b,a.authorID=c,a.cancel=function(){e.dismiss("cancel")},a.send=function(b){g.post("changeQuestionAccepted",{State:-1,QuestionID:a.questionID,AdminPermissionLevel:session.AdminPermissionLevel,UserID:a.authorID,Message:b}).then(function(a){a&&"success"==a.Status?(g.popSuccess("وضعیت سوال با موفقیت تغییر کرد!"),e.dismiss("cancel")):g.popError("مشکل در تغییر وضعیت سوال ، لطفا دوباره تلاش کنید.")})}}],size:"md"});e.result.then(function(){},function(){a.pagingController.update()})}})},a.changePosition=function(){a.pagingParams.OrganizationID=a.Position.selected?a.Position.selected.ID:null,a.search()},activeElement("#SQuestions","#SS"+h.id),fixFooter()}]),angular.module(appName).controller("OrganReportingCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$stateParams","$uibModal","Extention",function(a,b,c,d,e,f,g,h,i){a.Position={selected:null},a.StackChartData=[],a.data={},i.postAsync("getAllPositions",{}).then(function(b){a.allPositions=b}),a.changePosition=function(){a.dateChanged()},a.stackChartOptions=[{fillAlphas:.8,lineAlpha:.2,type:"column",valueField:"QTotal",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs(a.values.value.toString()).englishNumber().toString()},balloonFunction:function(a){return'<b style="font-size: 15px">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs(a.values.value.toString()).englishNumber().toString()+"</span><span style='font-size=15px'>سوال</span>"}},{fillAlphas:.8,lineAlpha:.2,type:"column",valueField:"ATotal",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs((-a.values.value).toString()).englishNumber().toString()},balloonFunction:function(a){return'<b style="font-size: 15px;">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs((-a.values.value).toString()).englishNumber().toString()+"</span><span style='font-size=15px'>جواب</span>"}},{fillAlphas:1,lineAlpha:0,type:"column",valueField:"ATotalNA",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs((-a.values.value).toString()).englishNumber().toString()},balloonFunction:function(a){var b='<b style="font-size: 15px">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs((-a.values.value).toString()).englishNumber().toString()+"</span><span style='font-size=15px'>جواب تایید نشده</span>";return b}},{fillAlphas:1,lineAlpha:0,type:"column",valueField:"QTotalNA",labelText:"[[value]]",clustered:!1,labelFunction:function(a){return persianJs(a.values.value.toString()).englishNumber().toString()},balloonFunction:function(a){return'<b style="font-size: 15px">'+persianJs(a.category).englishNumber().toString()+"</b><br><span class='pull-right' style='font-size=15px'> &nbsp;"+persianJs(a.values.value.toString()).englishNumber().toString()+"</span><span style='font-size=15px'>سوال تایید نشده</span>"}}],a.getChartData=function(b,c,d){i.post("getReportChartData",{OrganizationID:b,StartDate:c,EndDate:d}).then(function(b){a.data=b,console.log(b)})},a.dateChanged=function(){var b=null,c=null;if(a.EndDate)var b=new Date(a.toFullEnd.unix);if(a.StartDate)var c=new Date(a.toFullStart.unix);a.Position.selected?a.getChartData(a.Position.selected.ID,c,b):a.getChartData(null,c,b)},a.getChartData(null,null,null),activeElement("#SReporting","#SOrganReport")}]),angular.module(appName).controller("ReportingCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$stateParams","$uibModal","Extention",function(a,b,c,d,e,f,g,h,i){a.pagingParams={Position:null},a.pagingController={},a.users=[],a.Position={selected:null},a.Forum={selected:null},a.Forums=[],i.postAsync("getAllPositions",{}).then(function(b){a.allPositions=b}),i.postAsync("getAllForumTypes",{}).then(function(b){a.Forums=b.Data}),a.search=function(){a.pagingController.update()},a.changeForum=function(){a.pagingParams.ForumMainSubjectID=a.Forum.selected?a.Forum.selected.ID:null,a.search()},a.changePosition=function(){a.pagingParams.OrganizationID=a.Position.selected?a.Position.selected.ID:null,a.search()},a.getBGColor=function(a){switch(a=a%15+1){case 1:return"bg-red-active";case 2:return"bg-yellow-active";case 3:return"bg-aqua-active";case 4:return"bg-blue-active";case 5:return"bg-light-blue-active";case 6:return"bg-green-active";case 7:return"bg-navy-active";case 8:return"bg-teal-active";case 9:return"bg-olive-active";case 10:return"bg-lime-active";case 11:return"bg-orange-active";case 12:return"bg-fuchsia-active";case 13:return"bg-purple-active";case 14:return"bg-maroon-active";case 15:return"bg-black-active";default:return"bg-red-active"}},activeElement("#SReporting","#SPersonReport")}]),angular.module(appName).controller("NewSurveyCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Extention","Upload",function(a,b,c,d,e,f,g){a.mindate=Date.now(),a.survey={Options:[]},a.editMode=!1,a.SurveyTypes=[],a.surveyType={selected:null},a.newOption="",f.post("Survey/getAllSurveyTypes",{}).then(function(b){b&&"success"==b.Status&&(a.SurveyTypes=b.Data)}),a.addNewOption=function(){return a.newOption.length<3?void f.popError("متن گزینه را وارد کنید"):(a.survey.Options.push({SurveyText:a.newOption}),void(a.newOption=""))},a.removeOption=function(b){a.survey.Options.splice(b,1)},a.saveSurvey=function(){return a.survey.toFullStart.unix?a.survey.toFullEnd.unix?a.survey.Title?a.survey.Name?a.surveyType.selected?a.survey.Description?a.survey.Options.length<2?void f.popError("تعداد گزینه های نظرسنجی کافی نیست"):(a.survey.ExpireDate=new Date(a.survey.toFullEnd.unix),a.survey.StartDate=new Date(a.survey.toFullStart.unix),a.survey.SurveyTypeID=a.surveyType.selected.ID,void f.post("Survey/saveSurvey",a.survey).then(function(a){a&&"success"==a.Status?(f.popSuccess("نظرسنجی با موفقیت اضافه شد!"),d.go("survey_manager")):f.popError("مشکل در افزودن نظرسنجی ، لطفا دوباره امتحان کنید.")})):void f.popError("متن نظرسنجی را انتخاب کنید"):void f.popError("نوع نظرسنجی را انتخاب کنید"):void f.popError("اسم نظرسنجی را انتخاب کنید"):void f.popError("عنوان نظرسنجی را انتخاب کنید"):void f.popError("تاریخ اتمام نظرسنجی را انتخاب کنید"):void f.popError("تاریخ شروع نظرسنجی را انتخاب کنید")},a.fieldChanged=function(b,c){a.survey.Description=a.survey.Description.replace(/¬/g," ").replace(/&#173;/g," ").replace(/&#8204;/g," ").replace(/&#34;/g,'"')},activeElement("#SSurvey","#SNewSurvey")}]),angular.module(appName).controller("SurveyManagerCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$stateParams","$uibModal","Extention",function(a,b,c,d,e,f,g,h,i){a.pagingController={},a.deleteSurvey=function(b){i.post("Survey/deleteSurvey",{surveyID:b.ID}).then(function(b){b&&"success"==b.Status?(i.popSuccess("نظرسنجی با موفقیت حذف شد!"),a.pagingController.update()):i.popError("مشکل در حذف پیام ، لطفا دوباره امتحان کنید.")})},a.openSurveyModal=function(a){h.open({animation:!0,templateUrl:"survey.html",controller:["$scope","$uibModalInstance",function(b,c){b.Survey={},i.post("Survey/getSurveyByID",{SurveyID:a.ID}).then(function(a){console.log(a),a&&"success"==a.Status&&(b.Survey=a.Data)}),b.getProgressValueStyle=function(a,b){var c=Number(b),d=Number(a);return 0==c?0:d/c*100},b.getProgresColor=function(a){switch(a=a%5+1){case 1:return"progress-bar-green";case 2:return"progress-bar-danger";case 3:return"progress-bar-info";case 4:return"progress-bar-warning";case 5:return"progress-bar-primary";default:return"progress-bar-yellow"}},b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},a.openSurveyUpdate=function(a){h.open({animation:!0,templateUrl:"surveyUpdate.html",controller:["$scope","$uibModalInstance",function(b,c){b.mindate=Date.now(),b.ExpireDate=new Date(Date.parse(a.ExpireDate.replace("-","/","g"))).getTime(),console.log(b.mindate),b.survey=a,b.cancel=function(){c.dismiss("cancel")},b.upgrade=function(){if(!b.toFull.unix)return void i.popError("تاریخ اتمام پاپ آپ را انتخاب کنید");var a=new Date(b.toFull.unix);i.post("Survey/updateSurvey",{ExpireDate:a,SurveyID:b.survey.ID}).then(function(a){a&&"success"==a.Status?(i.popSuccess("نظرسنجی با موفقیت تمدید شد!"),b.cancel()):i.popError("مشکل در تمدید نظرسنجی ، لطفا دوباره امتحان کنید.")})}}],size:"md"})},activeElement("#SSurvey","#SAllSurveys")}]),angular.module(appName).controller("AllUsersCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","Extention","$uibModal",function(a,b,c,d,e,f,g,h){a.pagingParams={userType:null},a.pagingController={},a.user={},a.dropDwonTitle="نمایش اعضا",a.genderDropDwonTitle="جنسیت افراد",a.Position={},g.postAsync("getAllPositions",{}).then(function(b){a.allPositions=b}),a.openUserModal=function(a){h.open({animation:!0,templateUrl:"UserDetail.html",controller:["$scope","$uibModalInstance",function(b,c){b.user=a,console.log(b.user),b.cancel=function(){c.dismiss("cancel")}}],size:"md"})},a.search=function(){a.pagingController.update()},a.changeUserState=function(b,c){g.post("changeUserAccepted",{State:c,UserID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("وضعیت کاربر با موفقیت تغییر کرد!"),a.pagingController.update()):g.popError("مشکل در تغییر وضعیت کاربر ، لطفا دوباره تلاش کنید.")})},a.removeUser=function(b){g.post("deleteUser",{UserID:b}).then(function(b){b&&"success"==b.Status?(g.popSuccess("کاربر با موفقیت حذف شد!"),a.pagingController.update()):g.popError("مشکل در حذف کاربر ، لطفا دوباره امتحان کنید.")})},a.changeTypeFilter=function(b){switch(a.pagingParams.userType=b,b){case null:a.dropDwonTitle="همه ی اعضا";break;case 1:a.dropDwonTitle="اعضای تایید شده";break;case 0:a.dropDwonTitle="اعضا در انتظار تایید";break;case-1:a.dropDwonTitle="اعضای تایید نشده";break;default:a.dropDwonTitle="نمایش اعضا"}a.search()},a.changeGenderFilter=function(b){switch(a.pagingParams.genderType=b,b){case null:a.genderDropDwonTitle="جنسیت افراد";break;case 1:a.genderDropDwonTitle="اعضای زن";break;case 0:a.genderDropDwonTitle="اعضای مرد";break;default:a.genderDropDwonTitle="جنسیت افراد"}a.search()},a.changePosition=function(){a.pagingParams.OrganizationID=a.Position.selected?a.Position.selected.ID:null,a.search()},activeElement("#SUsers")}]),angular.module(appName).controller("MainCtrl",["$scope","$rootScope","$routeParams","$state","$location","$timeout","$log","Extention","$cookies","$uibModal",function(a,b,c,d,e,f,g,h,i,j){h.postAsync("checkPopUp",{}).then(function(a){if("success"==a.Status&&null!=a.Data){var b=i.get("popup");if(b)return;var c=new Date;c.setDate(c.getDate()+1),i.put("popup","true",{expires:c,path:"/"}),j.open({animation:!0,templateUrl:"popUp.html",controller:["$scope","$uibModalInstance",function(b,c){b.popup=a.Data,b.cancel=function(){c.dismiss("cancel")}}],size:"md"})}}),a.UserMessages=[],a.AnswerBadge={},a.QuestionBadge={},a.UserBadge={},h.post("getSiteInfo").then(function(a){b.websiteInfo=a}),a.checkNowOnline=function(){return},a.notificationsUpdating=!0,a.messagesUpdating=!0,h.post("getAdminBadges").then(function(b){console.log(b),a.AnswerBadge=b.Data.Answer,a.QuestionBadge=b.Data.Question,a.UserBadge=b.Data.User,a.Message=b.Data.Message}),h.post("getUserNotifications").then(function(b){a.notifications=b.Data,a.notificationsUpdating=!1}),h.post("getUserMessages").then(function(b){a.messages=b,a.messagesUpdating=!1}),a.fullSearchData={SearchType:"0"},a.search=function(){return a.pagingParams.searchValue?(a.pagingControllerSearch.update(),b.globalSearchActive=!0,void(a.pageTitle=d.current.resolve.$title())):void(b.globalSearchActive=!1);
},a.searchBoxChanged=function(){if(!a.pagingParams.searchValue&&b.globalSearchActive)return void(b.globalSearchActive=!1)},a.searchTypeChanges=function(b){a.pagingParams.searchType=b,a.search()},a.backFromSearch=function(){b.globalSearchActive=!1,a.searchResult=[]},a.getRandomColorClass=function(b){var c=b%a.bgColorArray.length;return a.bgColorArray[c]},a.updateMessages=function(b){b&&b.stopPropagation(),a.messagesUpdating?h.popInfo("لطفا کمی صبر کنید..."):(a.messagesUpdating=!0,h.postAsync("getUserMessages").then(function(b){a.messages=b,a.messagesUpdating=!1}))},a.updateNotifications=function(b){b&&b.stopPropagation(),a.notificationsUpdating?h.popInfo("لطفا کمی صبر کنید..."):(a.notificationsUpdating=!0,h.postAsync("getUserNotifications").then(function(b){a.notifications=b.Data,a.notificationsUpdating=!1}))},a.markLastNotifications=function(b){b.stopPropagation(),a.notificationsUpdating?h.popInfo("لطفا کمی صبر کنید..."):(a.notificationsUpdating=!0,h.postAsync("markLastNotifications").then(function(b){a.notifications=b.Data,a.notificationsUpdating=!1}))}}]);